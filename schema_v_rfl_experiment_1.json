{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "RFL Experiment Log Schema v1",
  "description": "Standardized schema for RFL (Reinforcement Learning from Feedback) experiment telemetry.",
  "type": "object",
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "1.0.0",
      "description": "Version of this schema."
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of the log entry."
    },
    "run_id": {
      "type": "string",
      "description": "Unique identifier for the execution session."
    },
    "cycle_index": {
      "type": "integer",
      "minimum": 0,
      "description": "Sequence number of the RFL cycle."
    },
    "mode": {
      "type": "string",
      "enum": ["baseline", "rfl"],
      "description": "Experiment mode: 'baseline' (no policy update) or 'rfl' (active learning)."
    },
    "config": {
      "type": "object",
      "description": "Configuration context for the experiment.",
      "properties": {
        "experiment_id": { "type": "string" },
        "slice_id": { "type": "string" },
        "policy_id": { "type": "string" },
        "seed": { "type": "string" }
      },
      "required": ["experiment_id", "slice_id", "policy_id"]
    },
    "attestation": {
      "type": "object",
      "description": "Cryptographic proofs and roots.",
      "properties": {
        "h_t": { 
          "type": "string", 
          "pattern": "^[a-fA-F0-9]{64}$",
          "description": "Composite Attestation Root H_t = SHA256(R_t || U_t)."
        },
        "r_t": { 
          "type": "string", 
          "pattern": "^[a-fA-F0-9]{64}$",
          "description": "Reasoning Root."
        },
        "u_t": { 
          "type": "string", 
          "pattern": "^[a-fA-F0-9]{64}$",
          "description": "UI/Input Root."
        }
      },
      "required": ["h_t"]
    },
    "metrics": {
      "type": "object",
      "description": "Quantitative measurements.",
      "properties": {
        "abstention": {
          "type": "object",
          "properties": {
            "rate": { 
              "type": "number", 
              "minimum": 0, 
              "maximum": 1,
              "description": "Abstention rate (alpha_rate)."
            },
            "mass": { 
              "type": "number", 
              "minimum": 0,
              "description": "Total abstention mass (alpha_mass)."
            },
            "attempt_mass": { 
              "type": "number", 
              "minimum": 0,
              "description": "Total attempts considered."
            },
            "tolerance": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Abstention tolerance threshold (tau)."
            }
          },
          "required": ["rate", "mass"]
        },
        "derivation": {
          "type": "object",
          "description": "Metrics mapped from DERIVATION_SUMMARY.",
          "properties": {
            "candidates_total": { "type": "integer", "minimum": 0 },
            "verified_count": { "type": "integer", "minimum": 0 },
            "abstained_count": { "type": "integer", "minimum": 0 },
            "depth_max": { "type": "integer", "minimum": 0 }
          }
        },
        "performance": {
          "type": "object",
          "description": "System performance metrics.",
          "properties": {
            "latency_ms": { "type": "number", "minimum": 0 },
            "throughput_ops": { "type": "number", "minimum": 0 },
            "memory_mb": { "type": "number", "minimum": 0 }
          }
        }
      },
      "required": ["abstention"]
    },
    "rfl_law": {
      "type": "object",
      "description": "RFL Law transformation details (optional for baseline).",
      "properties": {
        "step_id": { "type": "string" },
        "symbolic_descent": { "type": "number" },
        "policy_reward": { "type": "number" },
        "mass_delta": { "type": "number" },
        "update_applied": { "type": "boolean" }
      }
    }
  },
  "required": ["schema_version", "timestamp", "cycle_index", "mode", "config", "attestation", "metrics"]
}
