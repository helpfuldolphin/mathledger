# RFL Abstention Analysis

**Analyst:** GEMINI-D  
**Status:** Experimental  
**Last Updated:** 2025-11-27

## Schema Contract (Data Producer: GEMINI-B)

The analysis script acts as a consumer of FO Runner logs. It expects `JSONL` files where each row represents one cycle.

**Required Fields:**
- `cycle` (int): Monotonically increasing cycle index (0-based or 1-based).
- `status` (str): "verified", "abstain", "failed", etc.
- `method` (str): The verification method used (e.g., "lean", "lean-disabled", "taut", "auto").
  - *Note:* `verification_method` is accepted as an alias for `method`.

**Logic:**
An entry counts as an **Abstention** if:
1. `status` is explicitly `"abstain"` (case-insensitive).
2. `method` (or `verification_method`) is `"lean-disabled"`.

---

## Overview

This document defines the methodology for quantifying the impact of **Recursive Feedback Learning (RFL)** on the system's tendency to "abstain" (give up) when proving statements.

Our primary hypothesis is that **RFL reduces the long-term abstention rate** compared to a non-learning baseline. As the policy updates, the agent should learn to navigate proofs more effectively, reducing reliance on fallback mechanisms like `lean-disabled` or explicit early termination.

## Metrics

We track the following key metrics over the cycle index $t$:

### 1. Abstention Rate $A(t)$

The probability that the system abstains at cycle $t$. To visualize trends, we use a rolling window average (default $W=100$).

$$ A_{rolling}(t) = \frac{1}{W} \sum_{i=t-W+1}^{t} \mathbb{I}(\text{outcome}_i = \text{ABSTAIN}) $$

**Abstention Condition:**
An outcome is flagged as an abstention if:
- The status is explicitly marked `abstain`.
- The verification method recorded is `lean-disabled` (indicating the prover was disabled or unavailable, often a fallback for complex queries).

### 2. Cumulative Abstentions $C(t)$

The total count of abstentions accumulated up to cycle $t$.

$$ C(t) = \sum_{i=0}^{t} \mathbb{I}(\text{outcome}_i = \text{ABSTAIN}) $$

A divergence in the slope of $C(t)$ between Baseline and RFL runs indicates a sustained difference in reliability.

## Usage

Run the analysis script using the logs generated by the FO cycle runner:

```bash
python experiments/analyze_abstention_curves.py \
    --baseline results/fo_baseline.jsonl \
    --rfl results/fo_rfl.jsonl \
    --window-size 100 \
    --burn-in 200 \
    --out-summary artifacts/abstention_summary.json
```

### Inputs
- **Baseline Log (`--baseline`)**: JSONL log from a run with RFL disabled.
- **RFL Log (`--rfl`)**: JSONL log from a run with active policy updates.

### Outputs
1.  **`artifacts/figures/rfl_abstention_rate.png`**:
    - **X-Axis**: Cycle Index.
    - **Y-Axis**: Rolling Abstention Rate ($P(\text{abstain})$).
    - **Interpretation**: Look for the RFL curve (Red) dropping below the Baseline curve (Blue) after the burn-in period.

2.  **`artifacts/figures/rfl_cumulative_abstentions.png`**:
    - **X-Axis**: Cycle Index.
    - **Y-Axis**: Total Abstentions.
    - **Interpretation**: The RFL curve should have a shallower slope than the Baseline curve in the long run.

> **For Authors:** These two figures are intended as **Figure X** and **Figure Y** in the RFL research paper. Do not change filenames or visual semantics once the paper draft is locked.

3.  **Summary Stats**:
    - Prints method distribution (e.g., % `auto` vs % `lean-disabled`).
    - Calculates the mean abstention rate difference ($\Delta$) after the burn-in period.

## Notes on Interpretation

- **Sample Size**: These curves are generated from stochastic runs. Claims of improvement should be validated across multiple random seeds once the pipeline is mature.
- **Burn-in**: The "burn-in" period represents the initial phase where the RFL policy is untrained or unstable. Performance improvements are expected to manifest only after this phase.
- **Causality**: A reduction in abstention does not guarantee correctness (false positives are handled by a separate Integrity audit), but it does indicate increased *coverage* and *confidence*.
