{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "structural_drill_artifact.schema.json",
  "title": "Structural Drill Artifact",
  "description": "Complete artifact from P5 structural drill execution. SHADOW MODE: All drill operations are observational only.",
  "type": "object",
  "required": ["drill_id", "scenario_id", "started_at", "phases", "cycle_results", "summary"],
  "properties": {
    "drill_id": {
      "type": "string",
      "pattern": "^drill_[a-f0-9]{16}$",
      "description": "Unique drill execution identifier"
    },
    "scenario_id": {
      "type": "string",
      "description": "Scenario identifier (e.g., DRILL-SB-001)"
    },
    "started_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when drill started"
    },
    "completed_at": {
      "type": ["string", "null"],
      "format": "date-time",
      "description": "ISO 8601 timestamp when drill completed"
    },
    "phases": {
      "type": "array",
      "description": "Drill phase configurations",
      "items": {
        "type": "object",
        "required": ["name", "cycle_range", "expected_pattern", "expected_severity"],
        "properties": {
          "name": {
            "type": "string",
            "enum": ["baseline", "tension_onset", "structural_break", "escalation_active", "recovery"],
            "description": "Phase name"
          },
          "cycle_range": {
            "type": "array",
            "items": {"type": "integer"},
            "minItems": 2,
            "maxItems": 2,
            "description": "[start_cycle, end_cycle]"
          },
          "expected_pattern": {
            "type": "string",
            "enum": ["NONE", "DRIFT", "STRUCTURAL_BREAK"],
            "description": "Expected divergence pattern for this phase"
          },
          "expected_severity": {
            "type": "string",
            "enum": ["INFO", "WARN", "CRITICAL"],
            "description": "Expected severity level for this phase"
          },
          "description": {
            "type": "string",
            "description": "Human-readable phase description"
          }
        }
      }
    },
    "cycle_results": {
      "type": "array",
      "description": "Sampled cycle results",
      "items": {
        "type": "object",
        "required": ["cycle", "phase_name", "signal_id", "cohesion_score", "pattern", "severity", "streak"],
        "properties": {
          "cycle": {
            "type": "integer",
            "minimum": 1,
            "description": "Cycle number"
          },
          "phase_name": {
            "type": "string",
            "description": "Name of phase this cycle belongs to"
          },
          "signal_id": {
            "type": "string",
            "pattern": "^sgs_[a-f0-9]{16}$",
            "description": "Structural governance signal ID"
          },
          "cohesion_score": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "description": "Structural cohesion score [0,1]"
          },
          "combined_severity": {
            "type": "string",
            "enum": ["CONSISTENT", "TENSION", "CONFLICT"],
            "description": "Combined structural severity"
          },
          "admissible": {
            "type": "boolean",
            "description": "Whether P4 run is admissible (SI-001/SI-010 not violated)"
          },
          "pattern": {
            "type": "string",
            "enum": ["NONE", "DRIFT", "STRUCTURAL_BREAK"],
            "description": "Detected divergence pattern"
          },
          "severity": {
            "type": "string",
            "enum": ["INFO", "WARN", "CRITICAL"],
            "description": "Escalated severity level"
          },
          "streak": {
            "type": "integer",
            "minimum": 0,
            "description": "Current STRUCTURAL_BREAK streak count"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time",
            "description": "ISO 8601 timestamp of this cycle result"
          }
        }
      }
    },
    "summary": {
      "type": "object",
      "description": "Drill execution summary",
      "properties": {
        "total_cycles_sampled": {
          "type": "integer",
          "description": "Total number of cycles sampled"
        },
        "pattern_counts": {
          "type": "object",
          "additionalProperties": {"type": "integer"},
          "description": "Count of each pattern type detected"
        },
        "severity_counts": {
          "type": "object",
          "additionalProperties": {"type": "integer"},
          "description": "Count of each severity level"
        },
        "max_streak": {
          "type": "integer",
          "description": "Maximum STRUCTURAL_BREAK streak observed"
        },
        "break_events": {
          "type": "array",
          "items": {"type": "integer"},
          "description": "Cycle numbers where new break events started"
        },
        "phase_summaries": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {"type": "string"},
              "cycles_sampled": {"type": "integer"},
              "patterns_detected": {"type": "array", "items": {"type": "string"}},
              "expected_pattern": {"type": "string"},
              "pattern_match": {"type": "boolean"}
            }
          },
          "description": "Per-phase summary statistics"
        },
        "drill_success": {
          "type": "boolean",
          "description": "True if all phases matched expected patterns"
        }
      }
    },
    "metadata": {
      "type": "object",
      "description": "Drill execution metadata",
      "properties": {
        "sample_rate": {
          "type": "integer",
          "description": "Cycle sampling rate (record every Nth cycle)"
        },
        "shadow_mode": {
          "type": "boolean",
          "const": true,
          "description": "SHADOW MODE indicator (always true)"
        },
        "version": {
          "type": "string",
          "description": "Schema/runner version"
        }
      }
    }
  },
  "additionalProperties": false
}
