{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://mathledger.org/schemas/telemetry/telemetry_governance_signal.v1.1.0.json",
  "title": "Telemetry Governance Signal",
  "description": "Schema for telemetry-derived governance signals that inform Phase X P4 coupling and TDA feedback loops. This signal synthesizes telemetry health, conformance status, and anomaly detection into actionable governance decisions. SHADOW MODE: signals are observational only, no enforcement. P5.1: Includes RTTS mock detection and correlation analysis fields.",
  "version": "1.1.0",
  "type": "object",
  "required": [
    "schema_version",
    "signal_type",
    "signal_id",
    "timestamp",
    "status",
    "governance_recommendation",
    "telemetry_health",
    "anomaly_summary"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "1.0.0",
      "description": "Schema version for forward compatibility"
    },
    "signal_type": {
      "type": "string",
      "const": "telemetry_governance",
      "description": "Signal type identifier"
    },
    "signal_id": {
      "type": "string",
      "pattern": "^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$",
      "description": "UUID v4 unique identifier for this signal"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when signal was generated"
    },
    "mode": {
      "type": "string",
      "enum": ["SHADOW", "ACTIVE"],
      "default": "SHADOW",
      "description": "Signal mode. Must be SHADOW for Phase X P4."
    },
    "status": {
      "type": "string",
      "enum": ["OK", "ATTENTION", "WARN", "CRITICAL"],
      "description": "Overall telemetry governance status"
    },
    "governance_recommendation": {
      "type": "object",
      "description": "Governance recommendation derived from telemetry analysis",
      "required": ["action", "confidence", "reasons"],
      "properties": {
        "action": {
          "type": "string",
          "enum": ["PROCEED", "CAUTION", "REVIEW", "HALT_RECOMMENDED"],
          "description": "Recommended governance action (SHADOW MODE: logged only, not enforced)"
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Confidence in recommendation (0.0-1.0)"
        },
        "reasons": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Human-readable reasons for recommendation"
        },
        "safe_for_p4_coupling": {
          "type": "boolean",
          "description": "Whether telemetry state supports P4 real coupling"
        },
        "safe_for_promotion": {
          "type": "boolean",
          "description": "Whether current state allows slice promotion"
        },
        "enforcement_status": {
          "type": "string",
          "const": "LOGGED_ONLY",
          "description": "Must be LOGGED_ONLY in SHADOW mode"
        }
      },
      "additionalProperties": false
    },
    "telemetry_health": {
      "type": "object",
      "description": "Summary of telemetry substrate health",
      "required": ["overall_health", "emitter_status", "schema_conformance"],
      "properties": {
        "overall_health": {
          "type": "string",
          "enum": ["HEALTHY", "DEGRADED", "UNHEALTHY", "CRITICAL"],
          "description": "Aggregate telemetry health"
        },
        "health_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Quantified health score (1.0 = fully healthy)"
        },
        "emitter_status": {
          "type": "object",
          "properties": {
            "total_emitters": {
              "type": "integer",
              "minimum": 0
            },
            "healthy_emitters": {
              "type": "integer",
              "minimum": 0
            },
            "degraded_emitters": {
              "type": "integer",
              "minimum": 0
            },
            "silent_emitters": {
              "type": "integer",
              "minimum": 0
            }
          },
          "additionalProperties": false
        },
        "schema_conformance": {
          "type": "object",
          "properties": {
            "conformant": {
              "type": "boolean"
            },
            "drift_detected": {
              "type": "boolean"
            },
            "violations_count": {
              "type": "integer",
              "minimum": 0
            }
          },
          "additionalProperties": false
        },
        "data_freshness_seconds": {
          "type": "number",
          "minimum": 0,
          "description": "Age of most recent telemetry data in seconds"
        }
      },
      "additionalProperties": false
    },
    "anomaly_summary": {
      "type": "object",
      "description": "Summary of detected telemetry anomalies",
      "required": ["anomalies_detected", "anomaly_count"],
      "properties": {
        "anomalies_detected": {
          "type": "boolean",
          "description": "True if any anomalies detected"
        },
        "anomaly_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Total anomaly count in observation window"
        },
        "anomalies_by_severity": {
          "type": "object",
          "properties": {
            "INFO": {
              "type": "integer",
              "minimum": 0
            },
            "WARN": {
              "type": "integer",
              "minimum": 0
            },
            "CRITICAL": {
              "type": "integer",
              "minimum": 0
            }
          },
          "additionalProperties": false
        },
        "anomalies_by_type": {
          "type": "object",
          "properties": {
            "emission_gap": {
              "type": "integer",
              "minimum": 0,
              "description": "Gaps in expected telemetry emissions"
            },
            "schema_violation": {
              "type": "integer",
              "minimum": 0,
              "description": "Schema validation failures"
            },
            "rate_anomaly": {
              "type": "integer",
              "minimum": 0,
              "description": "Emission rate anomalies"
            },
            "value_anomaly": {
              "type": "integer",
              "minimum": 0,
              "description": "Unexpected values in telemetry fields"
            },
            "sequence_anomaly": {
              "type": "integer",
              "minimum": 0,
              "description": "Sequence gaps or out-of-order emissions"
            }
          },
          "additionalProperties": false
        },
        "tda_alert_triggered": {
          "type": "boolean",
          "description": "True if anomalies triggered TDA alert"
        }
      },
      "additionalProperties": false
    },
    "p4_coupling_context": {
      "type": "object",
      "description": "Context for Phase X P4 real coupling",
      "properties": {
        "coupling_supported": {
          "type": "boolean",
          "description": "True if telemetry substrate supports P4 coupling"
        },
        "adapter_ready": {
          "type": "boolean",
          "description": "True if TelemetryProviderInterface adapter is ready"
        },
        "snapshot_availability": {
          "type": "string",
          "enum": ["AVAILABLE", "STALE", "UNAVAILABLE"],
          "description": "Availability of telemetry snapshots for P4"
        },
        "divergence_tracking_active": {
          "type": "boolean",
          "description": "True if real vs twin divergence tracking is active"
        },
        "last_snapshot_cycle": {
          "type": "integer",
          "minimum": 0,
          "description": "Cycle number of last captured snapshot"
        }
      },
      "additionalProperties": false
    },
    "tda_feedback": {
      "type": "object",
      "description": "TDA (Topological Data Analysis) feedback from telemetry anomalies",
      "properties": {
        "feedback_available": {
          "type": "boolean",
          "description": "True if TDA feedback is available"
        },
        "topology_alert_level": {
          "type": "string",
          "enum": ["NORMAL", "ELEVATED", "WARNING", "CRITICAL"],
          "description": "TDA-derived alert level"
        },
        "betti_anomaly_detected": {
          "type": "boolean",
          "description": "True if Betti number anomaly detected"
        },
        "persistence_anomaly_detected": {
          "type": "boolean",
          "description": "True if persistence diagram anomaly detected"
        },
        "min_cut_capacity_degraded": {
          "type": "boolean",
          "description": "True if min-cut capacity has degraded"
        },
        "feedback_cycle": {
          "type": "integer",
          "minimum": 0,
          "description": "Cycle at which TDA feedback was computed"
        },
        "recommended_actions": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "TDA-recommended actions (observational only)"
        }
      },
      "additionalProperties": false
    },
    "correlation": {
      "type": "object",
      "description": "Correlation with other governance signals",
      "properties": {
        "conformance_snapshot_id": {
          "type": "string",
          "pattern": "^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$",
          "description": "UUID of correlated conformance snapshot"
        },
        "replay_safety_signal_id": {
          "type": "string",
          "pattern": "^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$",
          "description": "UUID of correlated replay safety signal"
        },
        "p4_divergence_cycle": {
          "type": "integer",
          "minimum": 0,
          "description": "P4 divergence cycle if correlated"
        }
      },
      "additionalProperties": false
    },
    "hash": {
      "type": "object",
      "description": "Cryptographic hash for audit trail",
      "properties": {
        "algorithm": {
          "type": "string",
          "enum": ["sha256", "blake3"]
        },
        "value": {
          "type": "string",
          "pattern": "^[a-f0-9]{64}$"
        }
      },
      "additionalProperties": false
    },
    "metadata": {
      "type": "object",
      "description": "Extensible metadata",
      "additionalProperties": true
    }
  },
  "additionalProperties": false,
  "examples": [
    {
      "schema_version": "1.0.0",
      "signal_type": "telemetry_governance",
      "signal_id": "550e8400-e29b-41d4-a716-446655440002",
      "timestamp": "2025-12-10T12:00:00.000000+00:00",
      "mode": "SHADOW",
      "status": "OK",
      "governance_recommendation": {
        "action": "PROCEED",
        "confidence": 0.95,
        "reasons": [
          "All emitters healthy",
          "No schema drift detected",
          "TDA metrics nominal"
        ],
        "safe_for_p4_coupling": true,
        "safe_for_promotion": true,
        "enforcement_status": "LOGGED_ONLY"
      },
      "telemetry_health": {
        "overall_health": "HEALTHY",
        "health_score": 0.98,
        "emitter_status": {
          "total_emitters": 6,
          "healthy_emitters": 6,
          "degraded_emitters": 0,
          "silent_emitters": 0
        },
        "schema_conformance": {
          "conformant": true,
          "drift_detected": false,
          "violations_count": 0
        },
        "data_freshness_seconds": 1.5
      },
      "anomaly_summary": {
        "anomalies_detected": false,
        "anomaly_count": 0,
        "anomalies_by_severity": {
          "INFO": 0,
          "WARN": 0,
          "CRITICAL": 0
        },
        "anomalies_by_type": {
          "emission_gap": 0,
          "schema_violation": 0,
          "rate_anomaly": 0,
          "value_anomaly": 0,
          "sequence_anomaly": 0
        },
        "tda_alert_triggered": false
      },
      "p4_coupling_context": {
        "coupling_supported": true,
        "adapter_ready": true,
        "snapshot_availability": "AVAILABLE",
        "divergence_tracking_active": true,
        "last_snapshot_cycle": 1000
      },
      "tda_feedback": {
        "feedback_available": true,
        "topology_alert_level": "NORMAL",
        "betti_anomaly_detected": false,
        "persistence_anomaly_detected": false,
        "min_cut_capacity_degraded": false,
        "feedback_cycle": 1000,
        "recommended_actions": []
      },
      "correlation": {
        "conformance_snapshot_id": "550e8400-e29b-41d4-a716-446655440001"
      },
      "hash": {
        "algorithm": "sha256",
        "value": "e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855"
      }
    },
    {
      "schema_version": "1.0.0",
      "signal_type": "telemetry_governance",
      "signal_id": "550e8400-e29b-41d4-a716-446655440003",
      "timestamp": "2025-12-10T12:05:00.000000+00:00",
      "mode": "SHADOW",
      "status": "WARN",
      "governance_recommendation": {
        "action": "CAUTION",
        "confidence": 0.75,
        "reasons": [
          "Schema drift detected in verification_result",
          "TDA min-cut capacity degraded",
          "Emission rate anomaly in u2_runner"
        ],
        "safe_for_p4_coupling": true,
        "safe_for_promotion": false,
        "enforcement_status": "LOGGED_ONLY"
      },
      "telemetry_health": {
        "overall_health": "DEGRADED",
        "health_score": 0.72,
        "emitter_status": {
          "total_emitters": 6,
          "healthy_emitters": 4,
          "degraded_emitters": 2,
          "silent_emitters": 0
        },
        "schema_conformance": {
          "conformant": false,
          "drift_detected": true,
          "violations_count": 3
        },
        "data_freshness_seconds": 2.1
      },
      "anomaly_summary": {
        "anomalies_detected": true,
        "anomaly_count": 5,
        "anomalies_by_severity": {
          "INFO": 2,
          "WARN": 3,
          "CRITICAL": 0
        },
        "anomalies_by_type": {
          "emission_gap": 0,
          "schema_violation": 3,
          "rate_anomaly": 2,
          "value_anomaly": 0,
          "sequence_anomaly": 0
        },
        "tda_alert_triggered": true
      },
      "tda_feedback": {
        "feedback_available": true,
        "topology_alert_level": "WARNING",
        "betti_anomaly_detected": false,
        "persistence_anomaly_detected": false,
        "min_cut_capacity_degraded": true,
        "feedback_cycle": 1050,
        "recommended_actions": [
          "Review schema drift in verification_result",
          "Investigate u2_runner emission rate drop"
        ]
      }
    }
  ]
}
