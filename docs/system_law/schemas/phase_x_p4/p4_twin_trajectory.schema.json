{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://mathledger.org/schemas/phase_x_p4/twin_trajectory.v1.0.0.json",
  "title": "P4 Twin Trajectory Record",
  "description": "Schema for shadow twin prediction records in P4 real-runner shadow coupling. JSONL format: one record per line. SHADOW MODE: predictions are computed locally with no feedback to real runner.",
  "version": "1.0.0",
  "type": "object",
  "required": [
    "cycle",
    "timestamp",
    "twin_state",
    "twin_prediction"
  ],
  "properties": {
    "cycle": {
      "type": "integer",
      "minimum": 1,
      "description": "Cycle index (1-indexed)"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO8601 timestamp of prediction"
    },
    "input_snapshot_hash": {
      "type": "string",
      "pattern": "^sha256:[a-f0-9]{64}$",
      "description": "Hash of input telemetry snapshot used for this prediction"
    },
    "twin_state": {
      "type": "object",
      "description": "Twin internal state at this cycle",
      "required": ["H", "rho", "tau", "beta", "in_omega"],
      "properties": {
        "H": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Twin entropy/health"
        },
        "rho": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Twin RSI"
        },
        "tau": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Twin threshold"
        },
        "beta": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Twin block rate"
        },
        "in_omega": {
          "type": "boolean",
          "description": "Twin in Omega region"
        }
      }
    },
    "twin_prediction": {
      "type": "object",
      "description": "Twin's prediction for next cycle outcome",
      "properties": {
        "success_prob": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Predicted success probability"
        },
        "predicted_success": {
          "type": "boolean",
          "description": "Binary success prediction"
        },
        "predicted_blocked": {
          "type": "boolean",
          "description": "Predicted block status"
        },
        "predicted_in_omega": {
          "type": "boolean",
          "description": "Predicted Omega membership"
        },
        "predicted_hard_ok": {
          "type": "boolean",
          "description": "Predicted HARD mode status"
        },
        "delta_p_predicted": {
          "type": "number",
          "description": "Predicted delta-p for this cycle"
        }
      }
    },
    "model_confidence": {
      "type": "number",
      "minimum": 0,
      "maximum": 1,
      "description": "Twin model's self-assessed confidence in prediction"
    }
  }
}
