{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://mathledger.org/schemas/curriculum/stress_console_tile.v1.0.0.json",
  "title": "Curriculum Stress Console Tile",
  "description": "Schema for console tile displaying curriculum transition stress metrics (CTRPK). Used by global health dashboard to monitor curriculum governance load during P5 operations.",
  "version": "1.0.0",
  "type": "object",
  "required": [
    "schema_version",
    "tile_type",
    "timestamp",
    "status_light",
    "headline",
    "ctrpk_summary"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "1.0.0",
      "description": "Schema version for forward compatibility"
    },
    "tile_type": {
      "type": "string",
      "const": "curriculum_stress",
      "description": "Tile type discriminator for dashboard routing"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when tile was generated"
    },
    "status_light": {
      "type": "string",
      "enum": ["GREEN", "YELLOW", "RED"],
      "description": "Visual status indicator based on CTRPK thresholds"
    },
    "headline": {
      "type": "string",
      "maxLength": 80,
      "description": "Brief status message for tile header (e.g., 'Curriculum Stable' or 'High Transition Pressure')"
    },
    "subheadline": {
      "type": "string",
      "maxLength": 120,
      "description": "Additional context (e.g., 'CTRPK: 0.42 | 3 requests in 7142 cycles')"
    },
    "ctrpk_summary": {
      "type": "object",
      "required": [
        "ctrpk",
        "transition_requests",
        "total_cycles",
        "measurement_window_minutes"
      ],
      "properties": {
        "ctrpk": {
          "type": "number",
          "minimum": 0,
          "description": "Curriculum Transition Requests Per 1K Cycles"
        },
        "transition_requests": {
          "type": "integer",
          "minimum": 0,
          "description": "Raw count of TRANSITION_REQUESTED signals in window"
        },
        "total_cycles": {
          "type": "integer",
          "minimum": 0,
          "description": "Total derivation cycles in measurement window"
        },
        "measurement_window_minutes": {
          "type": "integer",
          "minimum": 1,
          "description": "Duration of measurement window in minutes"
        },
        "blocked_requests": {
          "type": "integer",
          "minimum": 0,
          "description": "Transition requests that would have been blocked"
        },
        "successful_transitions": {
          "type": "integer",
          "minimum": 0,
          "description": "Transitions that passed all gates"
        }
      },
      "description": "Core CTRPK metrics"
    },
    "trend": {
      "type": "object",
      "required": ["direction"],
      "properties": {
        "direction": {
          "type": "string",
          "enum": ["IMPROVING", "STABLE", "DEGRADING"],
          "description": "CTRPK trend direction over observation window"
        },
        "ctrpk_1h": {
          "type": "number",
          "minimum": 0,
          "description": "CTRPK over last 1 hour"
        },
        "ctrpk_6h": {
          "type": "number",
          "minimum": 0,
          "description": "CTRPK over last 6 hours"
        },
        "ctrpk_24h": {
          "type": "number",
          "minimum": 0,
          "description": "CTRPK over last 24 hours"
        },
        "delta_vs_baseline": {
          "type": "number",
          "description": "Change from baseline CTRPK (positive = higher stress)"
        },
        "baseline_ctrpk": {
          "type": "number",
          "minimum": 0,
          "description": "Expected baseline CTRPK for comparison"
        }
      },
      "description": "CTRPK trend analysis"
    },
    "governance_summary": {
      "type": "object",
      "properties": {
        "active_slice": {
          "type": "string",
          "description": "Currently active curriculum slice"
        },
        "slice_age_cycles": {
          "type": "integer",
          "minimum": 0,
          "description": "Cycles since last slice transition"
        },
        "gates_evaluated": {
          "type": "integer",
          "minimum": 0,
          "description": "Total gate evaluations in window"
        },
        "gates_passed": {
          "type": "integer",
          "minimum": 0,
          "description": "Gate evaluations that passed all criteria"
        },
        "semantic_violations": {
          "type": "integer",
          "minimum": 0,
          "description": "SEMANTIC severity violations detected"
        },
        "parametric_changes": {
          "type": "integer",
          "minimum": 0,
          "description": "PARAMETRIC severity changes detected"
        }
      },
      "description": "Curriculum governance activity summary"
    },
    "council_status": {
      "type": "string",
      "enum": ["OK", "WARN", "BLOCK"],
      "description": "Uplift council status derived from CTRPK"
    },
    "alerts": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["level", "message"],
        "properties": {
          "level": {
            "type": "string",
            "enum": ["INFO", "WARNING", "ERROR", "CRITICAL"],
            "description": "Alert severity level"
          },
          "message": {
            "type": "string",
            "description": "Alert message"
          },
          "threshold_exceeded": {
            "type": "string",
            "description": "Which threshold was exceeded (e.g., 'CTRPK > 5.0')"
          },
          "recommendation": {
            "type": "string",
            "description": "Recommended action"
          }
        }
      },
      "description": "Active alerts related to curriculum stress"
    },
    "phase": {
      "type": "string",
      "enum": ["P3", "P4", "P5"],
      "description": "Current Phase X mode"
    },
    "mode": {
      "type": "string",
      "enum": ["SHADOW", "SHADOW_ACTIVE"],
      "description": "Enforcement mode"
    },
    "metadata": {
      "type": "object",
      "properties": {
        "curriculum_fingerprint": {
          "type": "string",
          "description": "Current curriculum configuration fingerprint"
        },
        "run_id": {
          "type": "string",
          "description": "Current run identifier"
        },
        "observer_version": {
          "type": "string",
          "description": "Version of stress observer"
        }
      },
      "description": "Additional metadata"
    }
  }
}
