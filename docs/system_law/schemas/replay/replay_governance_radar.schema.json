{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://mathledger.org/schemas/replay/replay_governance_radar.v1.0.0.json",
  "title": "Replay Governance Radar",
  "description": "Schema for replay governance radar view. Captures safety-radar alignment, divergence detection, and governance signal aggregation for Phase X replay validation.",
  "version": "1.0.0",
  "type": "object",
  "required": [
    "schema_version",
    "timestamp",
    "status",
    "governance_alignment",
    "safety_status",
    "radar_status"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "1.0.0",
      "description": "Schema version for forward compatibility"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when radar was computed"
    },
    "status": {
      "type": "string",
      "enum": ["ok", "warn", "block"],
      "description": "Combined governance status (collapsed from safety + radar)"
    },
    "governance_alignment": {
      "type": "string",
      "enum": ["aligned", "tension", "divergent"],
      "description": "Alignment between safety evaluation and governance radar"
    },
    "safety_status": {
      "type": "string",
      "enum": ["ok", "warn", "block"],
      "description": "Status from replay safety evaluation"
    },
    "radar_status": {
      "type": "string",
      "enum": ["ok", "warn", "block"],
      "description": "Status from governance radar subsystem"
    },
    "conflict": {
      "type": "boolean",
      "default": false,
      "description": "True if safety and radar diverge requiring manual review"
    },
    "reasons": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "List of prefixed reasons: [Safety], [Radar], [CONFLICT]"
    },
    "safe_for_policy_update": {
      "type": "boolean",
      "description": "Whether policy updates are permitted under current state"
    },
    "safe_for_promotion": {
      "type": "boolean",
      "description": "Whether promotion to next phase is permitted"
    },
    "metrics": {
      "type": "object",
      "properties": {
        "determinism_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Determinism confidence score (0-100)"
        },
        "hash_match_rate": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Fraction of replays with matching hashes"
        },
        "coverage_pct": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Replay coverage percentage"
        },
        "violation_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of replay violations detected"
        },
        "warning_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of replay warnings detected"
        }
      },
      "description": "Quantitative replay metrics"
    },
    "drift_indicators": {
      "type": "object",
      "properties": {
        "h_t_drift_detected": {
          "type": "boolean",
          "description": "True if H_t hash drift detected"
        },
        "config_drift_detected": {
          "type": "boolean",
          "description": "True if config hash drift detected"
        },
        "state_drift_detected": {
          "type": "boolean",
          "description": "True if state hash drift detected"
        },
        "drift_magnitude": {
          "type": "number",
          "minimum": 0,
          "description": "Magnitude of detected drift (domain-specific)"
        }
      },
      "description": "Drift detection indicators"
    },
    "p3_p4_binding": {
      "type": "object",
      "properties": {
        "phase": {
          "type": "string",
          "enum": ["P3", "P4", "unknown"],
          "description": "Current validation phase"
        },
        "shadow_mode": {
          "type": "boolean",
          "description": "True if operating in shadow mode"
        },
        "whitepaper_evidence_ready": {
          "type": "boolean",
          "description": "True if radar state is suitable for whitepaper evidence"
        }
      },
      "description": "P3/P4 safety doctrine binding metadata"
    }
  },
  "additionalProperties": false
}
