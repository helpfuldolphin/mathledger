{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://mathledger.org/schemas/budget/governance_signal.v1.0.0.json",
  "title": "Budget Governance Signal",
  "description": "Schema for GovernanceSignal objects emitted by the budget layer for cross-layer consumption. Used by P3 noise calibration, P4 divergence interpretation, and TDA context binding. SHADOW MODE: emitted but not consumed for active blocking.",
  "version": "1.0.0",
  "type": "object",
  "required": [
    "schema_version",
    "layer",
    "status",
    "severity",
    "timestamp"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "1.0.0",
      "description": "Schema version for compatibility tracking"
    },
    "layer": {
      "type": "string",
      "const": "budget",
      "description": "Layer identifier (always 'budget' for this schema)"
    },
    "status": {
      "type": "string",
      "enum": ["ok", "warn", "block"],
      "description": "Signal status: ok (nominal), warn (drift detected), block (invariant violation)"
    },
    "severity": {
      "type": "string",
      "enum": ["info", "warning", "critical"],
      "description": "Signal severity for alerting and prioritization"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO8601 timestamp of signal emission"
    },
    "message": {
      "type": "string",
      "maxLength": 256,
      "description": "Human-readable message describing signal context"
    },
    "reasons": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "List of reasons contributing to this signal status"
    },
    "metadata": {
      "type": "object",
      "description": "Extended metadata for cross-layer consumption",
      "properties": {
        "stability_class": {
          "type": "string",
          "enum": ["STABLE", "DRIFTING", "VOLATILE"],
          "description": "Overall budget stability classification"
        },
        "health_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Current budget health score (0-100)"
        },
        "stability_index": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Stability index from invariant timeline (0.0-1.0)"
        },
        "drift_trajectory": {
          "type": "array",
          "items": {
            "type": "number"
          },
          "description": "Recent drift values (last 5 windows) for trend analysis"
        },
        "inv_bud_failures": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["INV-BUD-1", "INV-BUD-2", "INV-BUD-3", "INV-BUD-4", "INV-BUD-5"]
          },
          "description": "List of currently failing budget invariants"
        },
        "p3_noise_multiplier": {
          "type": "number",
          "minimum": 1.0,
          "description": "Recommended noise floor multiplier for P3 Δp computation"
        },
        "p4_severity_multiplier": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Recommended divergence severity multiplier for P4 interpretation"
        },
        "budget_confounded": {
          "type": "boolean",
          "description": "True if current state should be marked as budget-confounded"
        },
        "trend_direction": {
          "type": "string",
          "enum": ["IMPROVING", "STABLE", "DEGRADING"],
          "description": "Current trend direction for projection"
        },
        "projection": {
          "type": "object",
          "description": "BNH-Φ projection summary",
          "properties": {
            "projected_stability_class": {
              "type": "string",
              "enum": ["STABLE", "DRIFTING", "VOLATILE", "UNKNOWN"]
            },
            "converging_invariants": {
              "type": "boolean"
            },
            "diverging_invariants": {
              "type": "boolean"
            },
            "horizon_length": {
              "type": "integer",
              "minimum": 1
            }
          }
        }
      }
    },
    "p3_binding": {
      "type": "object",
      "description": "Specific binding parameters for P3 First-Light integration",
      "properties": {
        "noise_floor_adjustment": {
          "type": "number",
          "minimum": 1.0,
          "description": "Noise floor multiplier for Δp computation"
        },
        "rsi_correction_factor": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "RSI correction factor for budget-induced stability bias"
        },
        "confounded_cycle_threshold": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Fraction of cycles considered budget-confounded"
        }
      }
    },
    "p4_binding": {
      "type": "object",
      "description": "Specific binding parameters for P4 divergence interpretation",
      "properties": {
        "severity_multiplier": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Divergence severity multiplier (1.0 = no adjustment)"
        },
        "root_cause_attribution": {
          "type": "string",
          "enum": ["MODEL", "RUNNER", "BUDGET", "COMBINED"],
          "description": "Recommended root cause attribution for divergence"
        },
        "tda_context_flag": {
          "type": "string",
          "enum": ["NOMINAL", "BUDGET_DRIFT", "BUDGET_UNSTABLE"],
          "description": "TDA interpretation context flag"
        }
      }
    },
    "cycle_range": {
      "type": "object",
      "description": "Cycle range this signal applies to",
      "properties": {
        "start_cycle": {
          "type": "integer",
          "minimum": 0
        },
        "end_cycle": {
          "type": "integer",
          "minimum": 0
        }
      }
    },
    "signal_hash": {
      "type": "string",
      "pattern": "^sha256:[a-f0-9]{64}$",
      "description": "SHA-256 hash of signal payload for audit trail"
    }
  },
  "additionalProperties": false
}
