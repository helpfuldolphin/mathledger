{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://mathledger.org/schemas/budget/director_panel.v1.0.0.json",
  "title": "Budget Director Panel",
  "description": "Schema for Budget Director Panel tile structure for Director Console display. Provides consolidated budget governance status, invariant health, drift trajectory, and projection summary in a console-ready format.",
  "version": "1.0.0",
  "type": "object",
  "required": [
    "schema_version",
    "timestamp",
    "status_light",
    "headline",
    "stability_class"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "1.0.0",
      "description": "Schema version for compatibility tracking"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO8601 timestamp of panel generation"
    },
    "status_light": {
      "type": "string",
      "enum": ["GREEN", "YELLOW", "RED"],
      "description": "Traffic light status for at-a-glance monitoring"
    },
    "headline": {
      "type": "string",
      "maxLength": 256,
      "description": "Neutral, factual summary headline for console display"
    },
    "stability_class": {
      "type": "string",
      "enum": ["STABLE", "DRIFTING", "VOLATILE", "UNKNOWN"],
      "description": "Current budget stability classification"
    },
    "health_score": {
      "type": "number",
      "minimum": 0,
      "maximum": 100,
      "description": "Current budget health score (0-100)"
    },
    "stability_index": {
      "type": "number",
      "minimum": 0,
      "maximum": 1,
      "description": "Stability index from invariant timeline (0.0-1.0)"
    },
    "invariant_summary": {
      "type": "object",
      "description": "Budget invariant status summary",
      "properties": {
        "all_ok": {
          "type": "boolean",
          "description": "True if all invariants are passing"
        },
        "failures": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["INV-BUD-1", "INV-BUD-2", "INV-BUD-3", "INV-BUD-4", "INV-BUD-5"]
          },
          "description": "List of currently failing invariants"
        },
        "failure_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Total count of failing invariants"
        },
        "recent_status": {
          "type": "string",
          "enum": ["OK", "WARN", "FAIL"],
          "description": "Most recent invariant check status"
        }
      }
    },
    "drift_summary": {
      "type": "object",
      "description": "Budget drift trajectory summary",
      "properties": {
        "current_drift": {
          "type": "number",
          "description": "Current drift value"
        },
        "drift_trend": {
          "type": "string",
          "enum": ["IMPROVING", "STABLE", "DEGRADING"],
          "description": "Drift trend direction"
        },
        "cumulative_drift": {
          "type": "number",
          "description": "Cumulative drift across measurement period"
        },
        "windows_analyzed": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of measurement windows analyzed"
        },
        "confounded_window_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Windows marked as budget-confounded"
        }
      }
    },
    "projection_summary": {
      "type": "object",
      "description": "BNH-Î¦ projection summary",
      "properties": {
        "projected_stability_class": {
          "type": "string",
          "enum": ["STABLE", "DRIFTING", "VOLATILE", "UNKNOWN"],
          "description": "Projected stability classification"
        },
        "converging": {
          "type": "boolean",
          "description": "True if budget health is trending toward stability"
        },
        "diverging": {
          "type": "boolean",
          "description": "True if budget health is trending toward instability"
        },
        "horizon_length": {
          "type": "integer",
          "minimum": 1,
          "description": "Projection horizon (number of future windows)"
        },
        "risk_trajectory": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["STABLE", "DRIFTING", "VOLATILE", "UNKNOWN"]
          },
          "description": "Per-window projected risk classification"
        }
      }
    },
    "episode_summary": {
      "type": "object",
      "description": "Budget storyline episode summary",
      "properties": {
        "episodes_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Total episodes identified"
        },
        "episode_status_distribution": {
          "type": "object",
          "properties": {
            "OK": {"type": "integer", "minimum": 0},
            "WARN": {"type": "integer", "minimum": 0},
            "FAIL": {"type": "integer", "minimum": 0}
          }
        },
        "first_hard_violation": {
          "type": ["string", "null"],
          "description": "Description of first hard invariant violation, or null if none"
        },
        "structural_events_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of structural events detected"
        }
      }
    },
    "phase_x_binding": {
      "type": "object",
      "description": "Phase X integration binding status",
      "properties": {
        "p3_noise_active": {
          "type": "boolean",
          "description": "True if P3 noise floor adjustment is active"
        },
        "p3_noise_multiplier": {
          "type": "number",
          "minimum": 1.0,
          "description": "Current P3 noise floor multiplier"
        },
        "p4_severity_active": {
          "type": "boolean",
          "description": "True if P4 severity adjustment is active"
        },
        "p4_severity_multiplier": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Current P4 divergence severity multiplier"
        },
        "tda_context": {
          "type": "string",
          "enum": ["NOMINAL", "BUDGET_DRIFT", "BUDGET_UNSTABLE"],
          "description": "Current TDA interpretation context"
        }
      }
    },
    "release_readiness": {
      "type": "object",
      "description": "Release readiness signal from budget layer",
      "properties": {
        "release_ok": {
          "type": "boolean",
          "description": "True if budget layer permits release"
        },
        "status": {
          "type": "string",
          "enum": ["OK", "WARN", "BLOCK"],
          "description": "Release readiness status"
        },
        "blocking_reasons": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "List of reasons blocking release (if any)"
        }
      }
    },
    "governance_signal_ref": {
      "type": "object",
      "description": "Reference to emitted GovernanceSignal",
      "properties": {
        "signal_status": {
          "type": "string",
          "enum": ["ok", "warn", "block"]
        },
        "signal_severity": {
          "type": "string",
          "enum": ["info", "warning", "critical"]
        },
        "signal_hash": {
          "type": "string",
          "pattern": "^sha256:[a-f0-9]{64}$"
        }
      }
    },
    "runs_analyzed": {
      "type": "integer",
      "minimum": 0,
      "description": "Total number of runs included in this panel"
    },
    "cycle_range": {
      "type": "object",
      "description": "Cycle range covered by this panel",
      "properties": {
        "start_cycle": {
          "type": "integer",
          "minimum": 0
        },
        "end_cycle": {
          "type": "integer",
          "minimum": 0
        }
      }
    },
    "panel_hash": {
      "type": "string",
      "pattern": "^sha256:[a-f0-9]{64}$",
      "description": "SHA-256 hash of panel content for audit trail"
    }
  },
  "additionalProperties": false
}
