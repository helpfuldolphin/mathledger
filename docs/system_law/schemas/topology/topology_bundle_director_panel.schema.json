{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://mathledger.org/schemas/topology/topology_bundle_director_panel.v1.0.0.json",
  "title": "Topology Bundle Director Panel",
  "description": "Schema for the Director Panel state that provides a unified dashboard view of topology, bundle, and governance alignment. Designed for real-time streaming to UI/monitoring systems. SHADOW MODE: read-only observation.",
  "version": "1.0.0",
  "type": "object",
  "required": [
    "schema_version",
    "panel_type",
    "timestamp",
    "mode",
    "topology_tile",
    "bundle_tile",
    "correlation_tile",
    "overall_health"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "1.0.0",
      "description": "Schema version for forward compatibility"
    },
    "panel_type": {
      "type": "string",
      "const": "topology_bundle_director",
      "description": "Panel type identifier"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO8601 timestamp of panel state"
    },
    "mode": {
      "type": "string",
      "const": "SHADOW",
      "description": "Observation mode - always SHADOW in Phase X"
    },
    "run_context": {
      "type": "object",
      "properties": {
        "run_id": {
          "type": "string",
          "description": "Current run identifier"
        },
        "phase": {
          "type": "string",
          "enum": ["P3", "P4"],
          "description": "Current Phase X phase"
        },
        "cycle": {
          "type": "integer",
          "minimum": 0,
          "description": "Current cycle number"
        },
        "total_cycles": {
          "type": "integer",
          "minimum": 0,
          "description": "Total planned cycles"
        },
        "progress_pct": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Run progress percentage"
        },
        "runner_type": {
          "type": "string",
          "enum": ["u2", "rfl"],
          "description": "Runner type"
        },
        "slice_name": {
          "type": "string",
          "description": "Curriculum slice name"
        }
      },
      "description": "Run context for the panel"
    },
    "topology_tile": {
      "type": "object",
      "required": ["mode", "health_status", "indicator_color"],
      "properties": {
        "mode": {
          "type": "string",
          "enum": ["STABLE", "DRIFT", "TURBULENT", "CRITICAL"],
          "description": "Current topology mode"
        },
        "mode_display": {
          "type": "string",
          "description": "Human-readable mode display text"
        },
        "health_status": {
          "type": "string",
          "enum": ["HEALTHY", "ATTENTION", "WARNING", "CRITICAL"],
          "description": "Topology health status for display"
        },
        "indicator_color": {
          "type": "string",
          "enum": ["green", "yellow", "orange", "red"],
          "description": "UI indicator color"
        },
        "betti_display": {
          "type": "object",
          "properties": {
            "beta_0": {
              "type": "integer",
              "description": "Current beta_0 value"
            },
            "beta_1": {
              "type": "integer",
              "description": "Current beta_1 value"
            },
            "bounds_ok": {
              "type": "boolean",
              "description": "True if Betti numbers within bounds"
            }
          },
          "description": "Betti numbers for display"
        },
        "persistence_display": {
          "type": "object",
          "properties": {
            "stability": {
              "type": "number",
              "description": "Persistence stability value"
            },
            "stability_pct_of_threshold": {
              "type": "number",
              "minimum": 0,
              "description": "Stability as percentage of threshold (100% = at threshold)"
            },
            "drift_warning": {
              "type": "boolean",
              "description": "True if approaching drift threshold"
            }
          },
          "description": "Persistence metrics for display"
        },
        "omega_display": {
          "type": "object",
          "properties": {
            "in_omega": {
              "type": "boolean",
              "description": "True if in safe region"
            },
            "boundary_distance_pct": {
              "type": "number",
              "minimum": 0,
              "maximum": 100,
              "description": "Distance to boundary as percentage"
            },
            "consecutive_outside": {
              "type": "integer",
              "minimum": 0,
              "description": "Consecutive cycles outside Omega"
            }
          },
          "description": "Safe region status for display"
        },
        "active_signals": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "code": {
                "type": "string",
                "pattern": "^TOPO-(OK|WARN|CRIT)-[0-9]{3}$"
              },
              "severity": {
                "type": "string",
                "enum": ["OK", "WARN", "CRITICAL"]
              },
              "message": {
                "type": "string"
              }
            }
          },
          "description": "Active topology signals with messages"
        },
        "mode_history": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "cycle": {"type": "integer"},
              "mode": {"type": "string"}
            }
          },
          "maxItems": 10,
          "description": "Recent mode history (last 10 transitions)"
        }
      },
      "description": "Topology status tile for director panel"
    },
    "bundle_tile": {
      "type": "object",
      "required": ["chain_status", "health_status", "indicator_color"],
      "properties": {
        "chain_status": {
          "type": "string",
          "enum": ["VALID", "WARN", "BROKEN", "MISSING"],
          "description": "Bundle chain status"
        },
        "chain_display": {
          "type": "string",
          "description": "Human-readable chain status"
        },
        "health_status": {
          "type": "string",
          "enum": ["HEALTHY", "ATTENTION", "WARNING", "CRITICAL"],
          "description": "Bundle health status for display"
        },
        "indicator_color": {
          "type": "string",
          "enum": ["green", "yellow", "orange", "red"],
          "description": "UI indicator color"
        },
        "current_bundle": {
          "type": "object",
          "properties": {
            "bundle_id_short": {
              "type": "string",
              "maxLength": 12,
              "description": "Shortened bundle ID for display"
            },
            "age_seconds": {
              "type": "number",
              "description": "Bundle age in seconds"
            },
            "age_display": {
              "type": "string",
              "description": "Human-readable age (e.g., '2.5s')"
            },
            "age_warning": {
              "type": "boolean",
              "description": "True if age exceeds threshold"
            }
          },
          "description": "Current bundle info for display"
        },
        "manifest_display": {
          "type": "object",
          "properties": {
            "valid": {
              "type": "boolean",
              "description": "Manifest validity"
            },
            "file_count": {
              "type": "integer",
              "description": "Number of files in manifest"
            },
            "trace_coverage_pct": {
              "type": "number",
              "minimum": 0,
              "maximum": 100,
              "description": "Trace coverage percentage"
            }
          },
          "description": "Manifest info for display"
        },
        "active_signals": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "code": {
                "type": "string",
                "pattern": "^BNDL-(OK|WARN|CRIT)-[0-9]{3}$"
              },
              "severity": {
                "type": "string",
                "enum": ["OK", "WARN", "CRITICAL"]
              },
              "message": {
                "type": "string"
              }
            }
          },
          "description": "Active bundle signals with messages"
        },
        "bundle_history": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "bundle_id_short": {"type": "string"},
              "status": {"type": "string"},
              "timestamp": {"type": "string"}
            }
          },
          "maxItems": 5,
          "description": "Recent bundle history (last 5)"
        }
      },
      "description": "Bundle status tile for director panel"
    },
    "correlation_tile": {
      "type": "object",
      "required": ["alignment", "health_status", "indicator_color"],
      "properties": {
        "alignment": {
          "type": "string",
          "enum": ["ALIGNED", "TENSION", "DIVERGENT", "FAULT"],
          "description": "Cross-correlation alignment status"
        },
        "alignment_display": {
          "type": "string",
          "description": "Human-readable alignment status"
        },
        "health_status": {
          "type": "string",
          "enum": ["HEALTHY", "ATTENTION", "WARNING", "CRITICAL"],
          "description": "Correlation health status for display"
        },
        "indicator_color": {
          "type": "string",
          "enum": ["green", "yellow", "orange", "red"],
          "description": "UI indicator color"
        },
        "p4_divergence_display": {
          "type": "object",
          "properties": {
            "active": {
              "type": "boolean",
              "description": "True if P4 divergence currently active"
            },
            "severity": {
              "type": "string",
              "enum": ["NONE", "INFO", "WARN", "CRITICAL"]
            },
            "streak_length": {
              "type": "integer",
              "minimum": 0,
              "description": "Current divergence streak length"
            },
            "divergence_rate_pct": {
              "type": "number",
              "minimum": 0,
              "maximum": 100,
              "description": "Divergence rate as percentage of cycles"
            }
          },
          "description": "P4 divergence status for display"
        },
        "correlation_insights": {
          "type": "object",
          "properties": {
            "topology_predicts_divergence": {
              "type": "boolean",
              "description": "True if topology drift historically precedes divergence"
            },
            "bundle_correlated_divergence": {
              "type": "boolean",
              "description": "True if bundle anomalies correlate with divergence"
            },
            "triple_fault_risk": {
              "type": "boolean",
              "description": "True if triple fault risk detected"
            },
            "correlation_confidence": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Confidence in correlation analysis"
            }
          },
          "description": "Cross-correlation insights"
        },
        "active_signals": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "code": {
                "type": "string",
                "pattern": "^XCOR-(OK|WARN|CRIT)-[0-9]{3}$"
              },
              "severity": {
                "type": "string",
                "enum": ["OK", "WARN", "CRITICAL"]
              },
              "message": {
                "type": "string"
              }
            }
          },
          "description": "Active correlation signals with messages"
        },
        "recent_events": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "cycle": {"type": "integer"},
              "event_type": {
                "type": "string",
                "enum": ["DIVERGENCE", "TOPOLOGY_DRIFT", "BUNDLE_ANOMALY", "TRIPLE_FAULT"]
              },
              "severity": {"type": "string"}
            }
          },
          "maxItems": 10,
          "description": "Recent correlation events"
        }
      },
      "description": "Cross-correlation status tile for director panel"
    },
    "overall_health": {
      "type": "object",
      "required": ["status", "indicator_color", "summary"],
      "properties": {
        "status": {
          "type": "string",
          "enum": ["NOMINAL", "ATTENTION", "WARNING", "CRITICAL"],
          "description": "Overall system health status"
        },
        "indicator_color": {
          "type": "string",
          "enum": ["green", "yellow", "orange", "red"],
          "description": "Overall UI indicator color"
        },
        "summary": {
          "type": "string",
          "description": "One-line health summary"
        },
        "component_summary": {
          "type": "object",
          "properties": {
            "topology_ok": {"type": "boolean"},
            "bundle_ok": {"type": "boolean"},
            "correlation_ok": {"type": "boolean"},
            "all_aligned": {"type": "boolean"}
          },
          "description": "Component health summary"
        },
        "highest_severity_signal": {
          "type": "object",
          "properties": {
            "code": {"type": "string"},
            "source": {
              "type": "string",
              "enum": ["TOPOLOGY", "BUNDLE", "CORRELATION"]
            },
            "message": {"type": "string"}
          },
          "description": "Highest severity signal across all components"
        },
        "hypothetical_governance_action": {
          "type": "string",
          "enum": ["CONTINUE", "CAUTION", "PAUSE", "ABORT"],
          "description": "Action that WOULD be taken if not in SHADOW mode"
        }
      },
      "description": "Overall health summary for director panel"
    },
    "metrics_summary": {
      "type": "object",
      "properties": {
        "cycles_in_stable": {
          "type": "integer",
          "minimum": 0,
          "description": "Cycles spent in STABLE topology mode"
        },
        "cycles_in_stable_pct": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Percentage of cycles in STABLE mode"
        },
        "mean_persistence_stability": {
          "type": "number",
          "description": "Mean persistence stability over run"
        },
        "bundle_validity_rate_pct": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Percentage of cycles with valid bundles"
        },
        "divergence_rate_pct": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "P4 divergence rate"
        },
        "alignment_rate_pct": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Percentage of cycles with full alignment"
        }
      },
      "description": "Aggregate metrics summary"
    },
    "update_metadata": {
      "type": "object",
      "properties": {
        "update_sequence": {
          "type": "integer",
          "minimum": 0,
          "description": "Sequence number for this update"
        },
        "update_frequency_hz": {
          "type": "number",
          "description": "Expected update frequency in Hz"
        },
        "last_update_delta_ms": {
          "type": "number",
          "description": "Milliseconds since last update"
        }
      },
      "description": "Update metadata for streaming"
    }
  },
  "additionalProperties": false,
  "examples": [
    {
      "schema_version": "1.0.0",
      "panel_type": "topology_bundle_director",
      "timestamp": "2025-12-10T00:05:00.000Z",
      "mode": "SHADOW",
      "run_context": {
        "run_id": "fl_20251210_000000_abc123",
        "phase": "P4",
        "cycle": 300,
        "total_cycles": 1000,
        "progress_pct": 30.0,
        "runner_type": "u2",
        "slice_name": "arithmetic_simple"
      },
      "topology_tile": {
        "mode": "STABLE",
        "mode_display": "Topology Stable",
        "health_status": "HEALTHY",
        "indicator_color": "green",
        "betti_display": {
          "beta_0": 1,
          "beta_1": 0,
          "bounds_ok": true
        },
        "persistence_display": {
          "stability": 0.03,
          "stability_pct_of_threshold": 20.0,
          "drift_warning": false
        },
        "omega_display": {
          "in_omega": true,
          "boundary_distance_pct": 65.0,
          "consecutive_outside": 0
        },
        "active_signals": [
          {
            "code": "TOPO-OK-001",
            "severity": "OK",
            "message": "Betti numbers within bounds"
          }
        ],
        "mode_history": []
      },
      "bundle_tile": {
        "chain_status": "VALID",
        "chain_display": "Bundle Chain Valid",
        "health_status": "HEALTHY",
        "indicator_color": "green",
        "current_bundle": {
          "bundle_id_short": "sha256:abc1...",
          "age_seconds": 1.5,
          "age_display": "1.5s",
          "age_warning": false
        },
        "manifest_display": {
          "valid": true,
          "file_count": 15,
          "trace_coverage_pct": 95.0
        },
        "active_signals": [
          {
            "code": "BNDL-OK-001",
            "severity": "OK",
            "message": "Bundle hash valid"
          }
        ],
        "bundle_history": []
      },
      "correlation_tile": {
        "alignment": "ALIGNED",
        "alignment_display": "Fully Aligned",
        "health_status": "HEALTHY",
        "indicator_color": "green",
        "p4_divergence_display": {
          "active": false,
          "severity": "NONE",
          "streak_length": 0,
          "divergence_rate_pct": 1.5
        },
        "correlation_insights": {
          "topology_predicts_divergence": false,
          "bundle_correlated_divergence": false,
          "triple_fault_risk": false,
          "correlation_confidence": 0.0
        },
        "active_signals": [
          {
            "code": "XCOR-OK-001",
            "severity": "OK",
            "message": "Topology-bundle aligned"
          }
        ],
        "recent_events": []
      },
      "overall_health": {
        "status": "NOMINAL",
        "indicator_color": "green",
        "summary": "All systems nominal - topology stable, bundles valid, fully aligned",
        "component_summary": {
          "topology_ok": true,
          "bundle_ok": true,
          "correlation_ok": true,
          "all_aligned": true
        },
        "highest_severity_signal": {
          "code": "TOPO-OK-001",
          "source": "TOPOLOGY",
          "message": "Betti numbers within bounds"
        },
        "hypothetical_governance_action": "CONTINUE"
      },
      "metrics_summary": {
        "cycles_in_stable": 285,
        "cycles_in_stable_pct": 95.0,
        "mean_persistence_stability": 0.04,
        "bundle_validity_rate_pct": 98.5,
        "divergence_rate_pct": 1.5,
        "alignment_rate_pct": 94.0
      },
      "update_metadata": {
        "update_sequence": 300,
        "update_frequency_hz": 1.0,
        "last_update_delta_ms": 1002
      }
    },
    {
      "schema_version": "1.0.0",
      "panel_type": "topology_bundle_director",
      "timestamp": "2025-12-10T00:12:00.000Z",
      "mode": "SHADOW",
      "run_context": {
        "run_id": "fl_20251210_000000_abc123",
        "phase": "P4",
        "cycle": 720,
        "total_cycles": 1000,
        "progress_pct": 72.0,
        "runner_type": "u2",
        "slice_name": "arithmetic_simple"
      },
      "topology_tile": {
        "mode": "DRIFT",
        "mode_display": "Topology Drift Detected",
        "health_status": "ATTENTION",
        "indicator_color": "yellow",
        "betti_display": {
          "beta_0": 1,
          "beta_1": 2,
          "bounds_ok": true
        },
        "persistence_display": {
          "stability": 0.11,
          "stability_pct_of_threshold": 73.3,
          "drift_warning": true
        },
        "omega_display": {
          "in_omega": true,
          "boundary_distance_pct": 15.0,
          "consecutive_outside": 0
        },
        "active_signals": [
          {
            "code": "TOPO-WARN-001",
            "severity": "WARN",
            "message": "Beta_1 approaching upper bound"
          },
          {
            "code": "TOPO-WARN-002",
            "severity": "WARN",
            "message": "Persistence drift > 0.10"
          }
        ],
        "mode_history": [
          {"cycle": 650, "mode": "STABLE"},
          {"cycle": 680, "mode": "DRIFT"}
        ]
      },
      "bundle_tile": {
        "chain_status": "WARN",
        "chain_display": "Bundle Chain Warning",
        "health_status": "WARNING",
        "indicator_color": "orange",
        "current_bundle": {
          "bundle_id_short": "sha256:def4...",
          "age_seconds": 35.0,
          "age_display": "35s",
          "age_warning": true
        },
        "manifest_display": {
          "valid": true,
          "file_count": 15,
          "trace_coverage_pct": 72.0
        },
        "active_signals": [
          {
            "code": "BNDL-WARN-001",
            "severity": "WARN",
            "message": "Bundle age exceeds threshold"
          },
          {
            "code": "BNDL-WARN-002",
            "severity": "WARN",
            "message": "Trace coverage below 80%"
          }
        ],
        "bundle_history": []
      },
      "correlation_tile": {
        "alignment": "TENSION",
        "alignment_display": "System Under Tension",
        "health_status": "WARNING",
        "indicator_color": "orange",
        "p4_divergence_display": {
          "active": true,
          "severity": "WARN",
          "streak_length": 8,
          "divergence_rate_pct": 5.2
        },
        "correlation_insights": {
          "topology_predicts_divergence": true,
          "bundle_correlated_divergence": false,
          "triple_fault_risk": false,
          "correlation_confidence": 0.68
        },
        "active_signals": [
          {
            "code": "XCOR-WARN-001",
            "severity": "WARN",
            "message": "Topology drift predicts divergence"
          }
        ],
        "recent_events": [
          {"cycle": 712, "event_type": "DIVERGENCE", "severity": "WARN"},
          {"cycle": 680, "event_type": "TOPOLOGY_DRIFT", "severity": "INFO"}
        ]
      },
      "overall_health": {
        "status": "WARNING",
        "indicator_color": "orange",
        "summary": "System under tension - topology drift, bundle age warning, P4 divergence active",
        "component_summary": {
          "topology_ok": false,
          "bundle_ok": false,
          "correlation_ok": false,
          "all_aligned": false
        },
        "highest_severity_signal": {
          "code": "XCOR-WARN-001",
          "source": "CORRELATION",
          "message": "Topology drift predicts divergence"
        },
        "hypothetical_governance_action": "CAUTION"
      },
      "metrics_summary": {
        "cycles_in_stable": 620,
        "cycles_in_stable_pct": 86.1,
        "mean_persistence_stability": 0.06,
        "bundle_validity_rate_pct": 92.0,
        "divergence_rate_pct": 5.2,
        "alignment_rate_pct": 82.0
      },
      "update_metadata": {
        "update_sequence": 720,
        "update_frequency_hz": 1.0,
        "last_update_delta_ms": 998
      }
    }
  ]
}
