{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://mathledger.org/schemas/slice_identity/console_tile.v1.0.0.json",
  "title": "Slice Identity Console Tile",
  "description": "Schema for console tile payload displaying real-time slice identity status. Used by global health dashboard to monitor identity stability during P3/P4 operations.",
  "version": "1.0.0",
  "type": "object",
  "required": [
    "schema_version",
    "tile_type",
    "timestamp",
    "status",
    "headline",
    "identity_summary"
  ],
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "1.0.0",
      "description": "Schema version for forward compatibility"
    },
    "tile_type": {
      "type": "string",
      "const": "slice_identity",
      "description": "Tile type discriminator for dashboard routing"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when tile was generated"
    },
    "status": {
      "type": "string",
      "enum": ["OK", "WARN", "ERROR", "UNKNOWN"],
      "description": "Overall identity status for visual indicator"
    },
    "headline": {
      "type": "string",
      "maxLength": 80,
      "description": "Brief status message for tile header"
    },
    "subheadline": {
      "type": "string",
      "maxLength": 120,
      "description": "Additional context below headline"
    },
    "identity_summary": {
      "type": "object",
      "required": [
        "current_slice",
        "fingerprint_stable",
        "drift_events_24h"
      ],
      "properties": {
        "current_slice": {
          "type": "string",
          "description": "Name of currently active slice"
        },
        "current_fingerprint": {
          "type": "string",
          "description": "Current slice fingerprint (truncated for display)"
        },
        "fingerprint_stable": {
          "type": "boolean",
          "description": "Whether fingerprint matches baseline"
        },
        "baseline_fingerprint": {
          "type": "string",
          "description": "Expected baseline fingerprint"
        },
        "drift_events_24h": {
          "type": "integer",
          "minimum": 0,
          "description": "Drift events in last 24 hours"
        },
        "drift_events_1h": {
          "type": "integer",
          "minimum": 0,
          "description": "Drift events in last hour"
        },
        "last_drift_at": {
          "type": ["string", "null"],
          "format": "date-time",
          "description": "Timestamp of most recent drift event"
        },
        "last_verification_at": {
          "type": "string",
          "format": "date-time",
          "description": "When identity was last verified"
        },
        "consecutive_stable_cycles": {
          "type": "integer",
          "minimum": 0,
          "description": "Cycles since last drift event"
        }
      },
      "description": "Core identity metrics"
    },
    "invariant_status": {
      "type": "object",
      "properties": {
        "SI-001": {
          "type": "string",
          "enum": ["PASS", "FAIL", "UNCHECKED"],
          "description": "Unique Slice Fingerprint invariant"
        },
        "SI-002": {
          "type": "string",
          "enum": ["PASS", "FAIL", "UNCHECKED"],
          "description": "Immutable Run Baseline invariant"
        },
        "SI-003": {
          "type": "string",
          "enum": ["PASS", "FAIL", "UNCHECKED"],
          "description": "Drift Detection Required invariant"
        },
        "SI-004": {
          "type": "string",
          "enum": ["PASS", "FAIL", "UNCHECKED"],
          "description": "Provenance Chain Continuity invariant"
        },
        "SI-005": {
          "type": "string",
          "enum": ["PASS", "FAIL", "UNCHECKED"],
          "description": "Identity-P4 Binding invariant"
        },
        "SI-006": {
          "type": "string",
          "enum": ["PASS", "FAIL", "UNCHECKED"],
          "description": "Cross-Run Identity Stability invariant"
        }
      },
      "description": "Status of each slice identity invariant"
    },
    "active_run": {
      "type": ["object", "null"],
      "properties": {
        "run_id": {
          "type": "string",
          "description": "Current P3/P4 run ID"
        },
        "run_type": {
          "type": "string",
          "enum": ["P3", "P4"],
          "description": "Run phase type"
        },
        "slice_locked": {
          "type": "boolean",
          "description": "Whether slice config is frozen for run"
        },
        "cycle": {
          "type": "integer",
          "minimum": 0,
          "description": "Current cycle number"
        },
        "identity_drift_detected": {
          "type": "boolean",
          "description": "Whether drift occurred during run"
        },
        "evidence_admissibility": {
          "type": "string",
          "enum": ["FULL", "PARTIAL", "INADMISSIBLE", "PENDING"],
          "description": "Current evidence chain admissibility"
        }
      },
      "description": "Active P3/P4 run context if any"
    },
    "alerts": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["level", "message"],
        "properties": {
          "level": {
            "type": "string",
            "enum": ["INFO", "WARNING", "ERROR", "CRITICAL"],
            "description": "Alert severity level"
          },
          "message": {
            "type": "string",
            "description": "Alert message"
          },
          "invariant_id": {
            "type": "string",
            "description": "Related invariant if applicable"
          },
          "action_required": {
            "type": "boolean",
            "description": "Whether operator action is needed"
          },
          "documentation_link": {
            "type": "string",
            "format": "uri",
            "description": "Link to relevant documentation"
          }
        }
      },
      "description": "Active alerts related to slice identity"
    },
    "trend": {
      "type": "object",
      "properties": {
        "direction": {
          "type": "string",
          "enum": ["IMPROVING", "STABLE", "DEGRADING"],
          "description": "Trend direction over observation window"
        },
        "drift_rate_7d": {
          "type": "number",
          "minimum": 0,
          "description": "Average drift events per day over 7 days"
        },
        "stability_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Composite stability score (1.0 = perfectly stable)"
        }
      },
      "description": "Trend analysis for identity stability"
    },
    "metadata": {
      "type": "object",
      "properties": {
        "curriculum_fingerprint": {
          "type": "string",
          "description": "Current curriculum fingerprint"
        },
        "curriculum_version": {
          "type": "string",
          "description": "Curriculum version string"
        },
        "slice_registry_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of slices in registry"
        },
        "observer_version": {
          "type": "string",
          "description": "Version of identity observer"
        }
      },
      "description": "Additional metadata for debugging"
    }
  }
}
