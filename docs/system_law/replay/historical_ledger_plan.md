# Historical Ledger Plan for Replay Governance

This document outlines the plan for storing, visualizing, and utilizing the history of replay governance snapshots to support long-term project health monitoring and substrate governance.

## 1. Data Storage and Schema

The historical ledger will be built by storing a curated summary of each `replay_governance_snapshot.json`.

### 1.1. File Naming and Location

- **Location**: A dedicated, version-controlled directory, e.g., `governance/replay_history/`.
- **Naming Convention**: Files will be named by date to ensure chronological order and uniqueness.
  - `YYYY-MM-DD.jsonl` (e.g., `2025-12-10.jsonl`)
- **Format**: JSON Lines (`.jsonl`), where each line is a JSON object representing a single governance run. This format is efficient for appending new records.

### 1.2. Schema for Historical Records

To keep the ledger concise and focused on trends, we will not store the full snapshot. Each record in the `.jsonl` file will contain the following schema:

```json
{
  "timestamp_utc": "2025-12-10T22:00:00Z",
  "run_id": "github-actions-run-12345",
  "commit_hash": "a1b2c3d4",
  "pr_number": 42,
  "radar_status": "STABLE",
  "determinism_rate": 99.8,
  "blocking_component": null
}
```

| Field | Type | Description |
| :--- | :--- | :--- |
| `timestamp_utc` | String | ISO 8601 timestamp. The primary key for time-series analysis. |
| `run_id` | String | Link back to the CI/CD run for full logs. |
| `commit_hash` | String | The git commit SHA that was evaluated. |
| `pr_number` | Integer | The associated pull request number, if applicable. |
| `radar_status` | String | The top-level verdict ("STABLE" or "UNSTABLE"). |
| `determinism_rate` | Float | The overall determinism rate for the run. |
| `blocking_component` | String | If the run was "UNSTABLE", this field holds the name of the primary component that caused the block. `null` otherwise. |

A daily CI job will aggregate the snapshots from all runs on a given day, transform them to the historical schema, and append them to the correct `YYYY-MM-DD.jsonl` file.

## 2. Visualization and Dashboards

The historical data will be used to generate simple, high-level dashboards for monitoring the health of the system over time.

### 2.1. Key Charts

1.  **Radar Status Over Time (Line Chart)**
    -   **X-axis**: Time (Day)
    -   **Y-axis**: Count of runs
    -   **Series**: Two lines, one for `STABLE` runs and one for `UNSTABLE` runs.
    -   **Purpose**: Provides an immediate visual signal of overall system stability. An increasing `UNSTABLE` count indicates a regression that needs investigation.

2.  **Determinism Rate Over Time (Line Chart)**
    -   **X-axis**: Time (Day)
    -   **Y-axis**: Determinism Rate (%)
    -   **Series**: A single line showing the average determinism rate for all runs on that day. A horizontal line should indicate the minimum acceptable threshold (e.g., 99.5%).
    -   **Purpose**: Tracks our core technical goal of determinism. A downward trend is a critical alert.

3.  **Top Blocking Components (Bar Chart)**
    -   **X-axis**: Component Name
    -   **Y-axis**: Count of "UNSTABLE" runs caused by that component.
    -   **Purpose**: Identifies systemic sources of instability. If one component appears frequently, it may require focused refactoring or debugging effort.

### 2.2. Implementation

These charts can be generated by a simple script that parses the `.jsonl` files and uses a library like Matplotlib (for static images) or Plotly (for interactive web-based charts). The generated dashboard can be a static Markdown file in the repository that is updated daily via a scheduled CI job.

## 3. Phase 0 Substrate Governance

The historical ledger is a critical asset for providing transparency and building trust with external reviewers, such as frontier labs or government partners (DoD).

### 3.1. Evidence Package

For "Phase 0" governance, we will provide reviewers with:
-   **The full `governance/replay_history/` directory**: This provides immutable, verifiable, and fine-grained evidence of our stability claims.
-   **The generated dashboards**: These offer a high-level, easily digestible summary of the historical data.
-   **A Governance README**: `governance/README.md` will explain the meaning of the metrics, the process for generating them, and how to interpret the charts.

### 3.2. Narrative for Reviewers

The key narrative this evidence supports is:
*"We define system stability through a quantifiable, automated, and rigorous replay governance process. The historical ledger provides a transparent, day-by-day record of our performance against this standard. This data demonstrates our commitment to maintaining high levels of determinism and reliability, and allows third parties to independently verify the stability of our substrate over time."*

This approach moves beyond verbal assurances to data-driven evidence, which is essential for building confidence with high-stakes partners.
