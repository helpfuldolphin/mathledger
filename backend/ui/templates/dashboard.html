<!doctype html><html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>MathLedger — Dashboard</title>
<style>
 body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;margin:0;background:#0b0f17;color:#e6edf3}
 header{padding:16px 20px;border-bottom:1px solid #1f2633;background:#0e1420;position:sticky;top:0}
 .brand{font-weight:700;letter-spacing:.3px}
 .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(230px,1fr));gap:14px;padding:16px 20px}
 .card{background:#111827;border:1px solid #1f2937;border-radius:12px;padding:16px}
 .k{font-size:12px;color:#9aa4b2;text-transform:uppercase;letter-spacing:.4px}
 .v{font-size:22px;margin-top:6px;word-break:break-all}
 .mono{font-family:ui-monospace,SFMono-Regular,Consolas,Menlo,monospace}
 table{width:100%;border-collapse:collapse;margin-top:8px}
 th,td{padding:8px 6px;border-bottom:1px solid #1f2937;text-align:left}
 a{color:#93c5fd;text-decoration:none} a:hover{text-decoration:underline}
 .muted{color:#9aa4b2;font-size:13px}
</style>
</head><body>
<header><div class="brand">MathLedger — Dashboard</div></header>

<main class="grid">
  <div class="card">
    <div class="k">Proofs (success)</div>
    <div class="v mono" id="proofsSuccess">—</div>
    <div class="muted">from live DB</div>
  </div>
  <div class="card">
    <div class="k">Proofs / hour</div>
    <div class="v mono" id="proofsHour">—</div>
    <div class="muted">last 5 min</div>
  </div>
  <div class="card">
    <div class="k">Block Height</div>
    <div class="v mono" id="blockHeight">—</div>
    <div class="muted">Latest merkle: <span class="mono" id="merkleShort">—</span></div>
  </div>
  <div class="card">
    <div class="k">Policy Hash</div>
    <div class="v mono" id="policyShort">—</div>
    <div class="muted" id="policyFull">—</div>
  </div>

  <div class="card" style="grid-column:1/-1">
    <div class="k">Recent Statements (latest 20)</div>
    <table>
      <thead><tr><th>Statement</th><th>Hash</th></tr></thead>
      <tbody id="recentBody">
        <tr><td colspan="2" class="muted">Loading…</td></tr>
      </tbody>
    </table>
  </div>
</main>

<script>
const $ = id => document.getElementById(id);
const short = (s,n=12) => s ? s.slice(0,n) + "…" : "—";

async function refresh() {
  try {
    const [hb, rc] = await Promise.all([
      fetch('/heartbeat.json', {cache:'no-store'}).then(r=>r.json()),
      fetch('/ui/recent.json', {cache:'no-store'}).then(r=>r.json())
    ]);
    const succ = hb.proofs?.success ?? 0;
    const pps  = hb.proofs_per_sec ?? 0;
    const pph  = Math.max(0, Math.floor(pps*3600));
    const height = hb.blocks?.height ?? 0;
    const merkle = hb.blocks?.latest?.merkle || '';
    const ph = hb.policy?.hash || '';

    $('proofsSuccess').textContent = succ.toLocaleString();
    $('proofsHour').textContent    = "~" + pph.toLocaleString();
    $('blockHeight').textContent   = height.toLocaleString();
    $('merkleShort').textContent   = short(merkle);
    $('policyShort').textContent   = ph ? short(ph,8) : "—";
    $('policyFull').textContent    = ph ? "…" + ph.slice(-8) : "—";

    const body = $('recentBody');
    body.innerHTML = '';
    const items = (rc.items || []);
    if (!items.length) {
      const tr=document.createElement('tr');
      tr.innerHTML = `<td colspan="2" class="muted">No statements yet.</td>`;
      body.appendChild(tr);
    } else {
      items.forEach(s=>{
        const tr=document.createElement('tr');
        const disp = (s.display || '').trim() || s.hash;
        tr.innerHTML = `
          <td class="mono"><a href="/ui/s/${s.hash}">${disp}</a></td>
          <td class="mono">${s.hash.slice(0,12)}…</td>`;
        body.appendChild(tr);
      });
    }
  } catch(e) {
    // swallow; will try again
  }
}
refresh();
setInterval(refresh, 2000);
</script>
</body></html>
