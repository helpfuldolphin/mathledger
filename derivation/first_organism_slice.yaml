# ============================================================================
# First Organism Derivation Slice - Canonical Configuration
# ============================================================================
#
# STATUS: SPEC / CONFIG DOCUMENTATION ONLY
#
# IMPORTANT: The live FO experiment currently uses the Python-config path
# make_first_organism_derivation_config() in derivation/pipeline.py.
# YAML loading is NOT YET WIRED into the runtime.
#
# PHASE-I RFL NOTE:
# All RFL runs (50-cycle baseline, 330-cycle experiments) use Python-only
# configuration. Neither the baseline nor RFL experiments read this YAML file.
# This file is documentation only and is NOT used in Phase-I Evidence Pack.
#
# This file documents the intended configuration and serves as the canonical
# reference. To use these values, the Python code must be updated to parse
# this YAML (Phase II work, not implemented).
#
# ============================================================================
#
# Purpose: Controlled abstention slice for First Organism integration test
# Version: 1.0.0
# Created: 2025-11-29
#
# This slice is designed as a controlled experimental apparatus that
# GUARANTEES at least one abstention when run with the companion seed
# statements defined in first_organism_seeds.yaml.
#
# ============================================================================

slice:
  name: "first-organism-slice"
  version: "1.0.0"
  description: >
    Minimal, deterministic derivation slice for First Organism abstention test.
    Seeds propositional atoms and implications, then applies Modus Ponens to
    derive non-tautologies that trigger verifier abstention.

# ---------------------------------------------------------------------------
# Core Derivation Bounds
# ---------------------------------------------------------------------------
# These parameters map directly to derivation.bounds.SliceBounds

bounds:
  # Maximum distinct propositional atoms permitted in a formula
  # Rationale: 2 atoms (p, q) is the minimal set that allows for interesting
  # MP derivation while keeping the search space tiny and deterministic.
  # With 2 atoms, we get 4 possible valuations (2^2), making truth-table
  # evaluation instantaneous.
  max_atoms: 2

  # Maximum syntactic depth of generated formulas
  # Rationale: Depth 2 allows simple implications like (p -> q) but prevents
  # deep nesting that would expand the search space. This is the minimal
  # depth that supports MP derivation from seed statements.
  max_formula_depth: 2

  # Maximum number of sequential Modus Ponens rounds per step
  # Rationale: Single MP round (depth 1) is sufficient to derive q from
  # seeds {p, p -> q}. More rounds are unnecessary for the FO experiment.
  max_mp_depth: 1

  # Cap on new statements accepted per derivation step
  # Rationale: Tight cap (4) ensures deterministic behavior and fast
  # execution. We only expect to derive a handful of statements.
  max_breadth: 4

  # Global cap on new statements accepted in a run
  # Rationale: Same as breadth_max for single-step FO runs. Prevents
  # runaway derivation in edge cases.
  max_total: 4

  # Maximum number of instantiated axioms seeded per run
  # Rationale: CRITICAL - Set to 0 to disable axiom seeding.
  # FO experiment uses explicit seed statements, not axiom instantiation.
  # This ensures the only MP candidates come from our controlled seeds.
  max_axiom_instances: 0

  # Cap on enumerated formulas used for substitution
  # Rationale: Small pool (8) for minimal memory footprint. Since
  # axiom_instances is 0, this is mostly unused but kept non-zero
  # for schema consistency.
  max_formula_pool: 8

  # Timeout for Lean fallback verification (seconds)
  # Rationale: CRITICAL - Set to 0.001s (1ms), effectively disabling Lean.
  # This ensures all non-tautologies trigger abstention via "lean-disabled"
  # rather than timing out unpredictably. The FO experiment must be hermetic
  # and not depend on a live Lean kernel.
  lean_timeout_s: 0.001

# ---------------------------------------------------------------------------
# Slice Gate Configuration
# ---------------------------------------------------------------------------
# These gates control when the slice passes/fails/abstains

gates:
  coverage:
    # Minimum CI lower bound for coverage gate
    # Rationale: Set very low (0.01) since FO is a controlled experiment,
    # not a production coverage gate.
    ci_lower_min: 0.01
    # Minimum sample size
    sample_min: 1
    # Attestation not required for FO (that's what we're testing)
    require_attestation: false

  abstention:
    # Maximum abstention rate percentage
    # Rationale: Set to 100% since FO *expects* abstention. This gate
    # won't block even if all candidates are abstained.
    max_rate_pct: 100.0
    # Maximum absolute abstention count
    max_mass: 1000

  velocity:
    # Minimum proofs per hour
    # Rationale: Set very low since FO runs are short and controlled.
    min_pph: 0.01
    # Maximum coefficient of variation for stability
    stability_cv_max: 1.0
    # Window size in minutes
    window_minutes: 1

  caps:
    # Minimum attempt mass (proof attempts)
    min_attempt_mass: 1
    # Minimum runtime in minutes
    min_runtime_minutes: 0.001
    # Maximum backlog ratio
    backlog_max: 1.0

# ---------------------------------------------------------------------------
# Metadata
# ---------------------------------------------------------------------------

metadata:
  # Human-readable description for telemetry and logging
  description: "Controlled abstention slice for First Organism test"

  # Expected outcome documentation
  expected_outcome: "At least one non-tautology derived via MP, abstained by verifier"

  # Deterministic flag - this slice produces identical results on every run
  # given the same seeds and bounds
  deterministic: true

  # Search space characterization
  search_space: "minimal"

  # Abstention guarantee flag - when true, this slice MUST produce abstention
  # The derivation pipeline can assert on this for validation
  abstention_guaranteed: true

  # Specific formula that will be abstained (for assertion)
  guaranteed_non_tautology: "q"

  # Expected verification method for abstained statements
  expected_abstention_method: "lean-disabled"

  # Formal rationale for why abstention is guaranteed
  abstention_rationale: >
    MP derives `q` from seeds `p` and `(p -> q)`. The formula `q` is a bare
    propositional atom, which is NEVER a tautology (it can be assigned False
    in the truth-table: when q=F, the formula evaluates to F). The truth-table
    verifier will reject it. Since Lean fallback is disabled (timeout=0.001s),
    the verifier returns method="lean-disabled", and the statement is recorded
    as an abstention.

# ---------------------------------------------------------------------------
# IMPLEMENTATION STATUS: Current Python vs YAML Config
# ---------------------------------------------------------------------------
#
# | Parameter            | Python FO Run (ACTIVE)  | YAML Value | Status                      |
# |----------------------|-------------------------|------------|-----------------------------|
# | max_atoms            | 2                       | 2          | MATCH - Not used in Phase-I RFL |
# | max_formula_depth    | 2                       | 2          | MATCH - Not used in Phase-I RFL |
# | max_mp_depth         | 1                       | 1          | MATCH - Not used in Phase-I RFL |
# | max_breadth          | 4                       | 4          | MATCH - Not used in Phase-I RFL |
# | max_total            | 4                       | 4          | MATCH - Not used in Phase-I RFL |
# | max_axiom_instances  | 0                       | 0          | MATCH - Not used in Phase-I RFL |
# | max_formula_pool     | 8                       | 8          | MATCH - Not used in Phase-I RFL |
# | lean_timeout_s       | 0.001                   | 0.001      | MATCH - Not used in Phase-I RFL |
# | gates.coverage       | (hardcoded in Python)   | (defined)  | NOT ACTIVE - Not used in Phase-I RFL |
# | gates.abstention     | (hardcoded in Python)   | (defined)  | NOT ACTIVE - Not used in Phase-I RFL |
# | gates.velocity       | (hardcoded in Python)   | (defined)  | NOT ACTIVE - Not used in Phase-I RFL |
# | gates.caps           | (hardcoded in Python)   | (defined)  | NOT ACTIVE - Not used in Phase-I RFL |
#
# The Python implementation in make_first_organism_derivation_config()
# (derivation/pipeline.py lines 808-894) defines these values directly.
# This YAML documents the same values but is NOT parsed at runtime.
#
# Phase II Work: Wire YAML loading into the FO harness.
#
# ---------------------------------------------------------------------------
# Compatibility Notes (Phase II - Not Yet Implemented)
# ---------------------------------------------------------------------------
#
# When YAML loading is implemented, this file would be parsed by:
#   - derivation.pipeline._bounds_from_slice() for SliceBounds extraction
#   - curriculum.gates.CurriculumSlice constructor
#   - Test fixtures in tests/integration/test_first_organism.py
#
# Parameter name mappings (YAML key -> SliceBounds attribute):
#   atoms              -> max_atoms
#   depth_max          -> max_formula_depth
#   mp_depth           -> max_mp_depth
#   breadth_max        -> max_breadth
#   total_max          -> max_total
#   axiom_instances    -> max_axiom_instances
#   formula_pool       -> max_formula_pool
#   lean_timeout_s     -> lean_timeout_s
#
# The _bounds_from_slice() function in derivation/pipeline.py handles
# multiple naming conventions for backward compatibility.

# ===========================================================================
# PHASE II: UPLIFT-CAPABLE DERIVATION SLICE
# ===========================================================================
#
# STATUS: PHASE-II DESIGN ONLY - NOT IMPLEMENTED
#
# This section defines a slice configuration designed to produce MIXED
# success/abstain patterns suitable for measuring RFL uplift. Unlike the
# Phase I slice (100% abstention), this produces ~30-50% abstention.
#
# IMPORTANT:
#   - This config is NOT used in Phase I Evidence Pack
#   - This config is NOT read by any current Python code
#   - This is a DESIGN TARGET for future implementation
#
# ===========================================================================

phase_ii_uplift_slice:
  # Metadata for this config section
  status: "phase-ii-design-only"
  used_in_phase_i_rfl: false
  requires_ml_enable_lean_fallback: false  # Uses truth-table only for determinism

  name: "first-organism-uplift-slice"
  version: "2.0.0-design"
  description: >
    Uplift-capable derivation slice for Phase II RFL experiments.
    Enables K/S axiom seeding to produce mixed success/abstain outcomes.
    Target abstention band: 20-70%.

  bounds:
    # More atoms for richer formula space
    max_atoms: 3

    # Deeper formulas for more MP opportunities
    max_formula_depth: 3

    # Two MP rounds for longer derivation chains
    max_mp_depth: 2

    # Wider exploration per step
    max_breadth: 32

    # More total candidates
    max_total: 64

    # CRITICAL: Enable K/S axiom seeding (unlike Phase I which has 0)
    # This produces tautologies that will be VERIFIED, creating mixed outcomes
    max_axiom_instances: 16

    # Larger substitution pool for axiom instantiation
    max_formula_pool: 32

    # Keep Lean disabled for determinism (truth-table only verification)
    lean_timeout_s: 0.001

  gates:
    coverage:
      ci_lower_min: 0.10
      sample_min: 5
      require_attestation: false

    abstention:
      # Tighter abstention bounds for uplift measurement
      # Target: 20-70% abstention rate
      max_rate_pct: 80.0
      max_mass: 100

    velocity:
      min_pph: 0.1
      stability_cv_max: 0.8
      window_minutes: 5

    caps:
      min_attempt_mass: 10
      min_runtime_minutes: 0.01
      backlog_max: 2.0

  metadata:
    description: "Uplift-capable slice for Phase II RFL experiments"
    expected_outcome: "Mixed success/abstain pattern with 20-70% abstention"
    deterministic: true
    search_space: "moderate"
    abstention_guaranteed: false  # NOT guaranteed - mixed outcomes expected
    target_abstention_band_min: 0.20
    target_abstention_band_max: 0.70

  # Verifier mode requirements
  verifier_requirements:
    mode: "truth-table-only"
    lean_enabled: false
    rationale: >
      Truth-table only mode ensures deterministic verification.
      K and S axiom instances are tautologies and will be VERIFIED.
      MP consequents that are non-tautologies will be ABSTAINED.
      This produces the mixed pattern needed for RFL uplift measurement.

  # Expected verification outcomes by formula type
  expected_outcomes:
    axiom_k_instances: "VERIFIED (tautology)"
    axiom_s_instances: "VERIFIED (tautology)"
    mp_tautology_consequents: "VERIFIED (tautology)"
    mp_non_tautology_consequents: "ABSTAINED (lean-disabled)"
    bare_atoms: "ABSTAINED (not tautology)"
    contingent_implications: "ABSTAINED (not tautology)"

  # Implementation notes for code agents
  implementation_notes:
    env_toggle: "FO_CONFIG_SOURCE=yaml"
    yaml_section: "phase_ii_uplift_slice"
    loader_function: "load_slice_from_yaml() - TO BE IMPLEMENTED"
    test_fixture: "test_phase_ii_uplift_mixed_outcomes() - TO BE IMPLEMENTED"
