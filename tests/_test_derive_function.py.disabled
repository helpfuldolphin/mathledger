#!/usr/bin/env python3
"""
Unit test for the derive function to ensure it can be imported and called.
"""

import unittest
import sys
import os

# Add the project root to the path
sys.path.insert(0, os.path.join(os.path.dirname(__file__), '..'))

from backend.axiom_engine.derive import derive


class TestDeriveFunction(unittest.TestCase):
    """Test the derive function for basic functionality."""

    def test_derive_function_import(self):
        """Test that derive function can be imported."""
        self.assertTrue(callable(derive))

    def test_derive_function_call(self):
        """Test that derive function can be called with basic parameters."""
        # Mock database session
        mock_session = None

        result = derive(
            db_session=mock_session,
            system_id=1,
            steps=1,
            breadth_cap=10,
            total_cap=100
        )

        # Check that it returns a dictionary with expected keys
        self.assertIsInstance(result, dict)
        self.assertIn('system_id', result)
        self.assertIn('steps', result)
        self.assertIn('breadth_cap', result)
        self.assertIn('total_cap', result)

        # Check values
        self.assertEqual(result['system_id'], 1)
        self.assertEqual(result['steps'], 1)
        self.assertEqual(result['breadth_cap'], 10)
        self.assertEqual(result['total_cap'], 100)

    def test_derive_function_defaults(self):
        """Test that derive function works with default parameters."""
        mock_session = None

        result = derive(db_session=mock_session, system_id=2)

        self.assertIsInstance(result, dict)
        self.assertEqual(result['system_id'], 2)
        self.assertEqual(result['steps'], 1)  # default
        self.assertEqual(result['breadth_cap'], 100)  # default
        self.assertEqual(result['total_cap'], 1000)  # default


if __name__ == '__main__':
    unittest.main()
