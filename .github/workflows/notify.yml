name: Notification Workflow

# Notification workflow with dry-run mode for testing

on:
  workflow_dispatch:
    inputs:
      dry_run:
        description: 'Dry run mode (no actual notifications sent)'
        required: false
        default: 'true'
        type: boolean
      message:
        description: 'Notification message'
        required: true
        type: string

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Validate message
      run: |
        echo "Validating notification message..."
        MESSAGE="${{ github.event.inputs.message }}"

        # Check ASCII-only
        if ! echo "$MESSAGE" | grep -qP '^[\x00-\x7F]*$'; then
          echo "Error: Non-ASCII characters detected in message"
          exit 1
        fi

        echo " Message validation passed"

    - name: Send notification (dry-run)
      if: github.event.inputs.dry_run == 'true'
      run: |
        echo "=== DRY RUN MODE ==="
        echo "Notification would be sent:"
        echo "Message: ${{ github.event.inputs.message }}"
        echo "Timestamp: $(date -u +%Y-%m-%dT%H:%M:%SZ)"
        echo "===================="

    - name: Send notification (production)
      if: github.event.inputs.dry_run == 'false'
      run: |
        echo "Sending notification..."
        # Add actual notification logic here (Slack, Discord, etc.)
        echo " Notification sent"
