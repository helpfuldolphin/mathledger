name: Compile and Verify Whitepaper

on:
  push:
    branches:
      - main
    paths:
      - 'docs/whitepaper/**'
      - 'Makefile'
      - '.github/workflows/**'

jobs:
  build_and_verify_latex:
    runs-on: ubuntu-latest
    steps:
      - name: Set up Git repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Needed for git hash

      - name: Compile LaTeX Document and Generate Hash
        uses: xu-cheng/texlive-action@v2
        env:
          GITHASH: ${{ github.sha }}
        with:
          run: |
            # latexmk is included in the texlive installation
            make all

      - name: Verify Artifact Integrity
        run: |
          echo "--- Verifying SHA256 Checksum ---"
          cd docs/whitepaper
          sha256sum --check main.pdf.sha256
          echo "Checksum verification successful."

      - name: Upload PDF and Checksum as Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: whitepaper-v1
          path: |
            docs/whitepaper/main.pdf
            docs/whitepaper/main.pdf.sha256