# Cursor H - Dyno Chart Sober Truth Report
## Reviewer 2 Mode: Evidence-Based Assessment

**Date:** 2025-01-02  
**Agent:** Cursor H (Plotting Specialist)  
**Mode:** Sober Truth / Reviewer 2  
**Objective:** Verify what actually exists, what the Dyno Chart is based on, and document inconsistencies.

---

## Executive Summary

**STATUS:** ⚠️ **MIXED REALITY**

- ✅ **Plotting Toolkit:** Complete and functional (`experiments/plotting.py`, `experiments/generate_dyno_chart.py`)
- ✅ **Existing Logs:** Real data exists (`fo_baseline.jsonl`, `fo_rfl_50.jsonl`, `fo_rfl_1000.jsonl`)
- ⚠️ **Dyno Chart:** File exists (`rfl_dyno_chart.png`) but provenance unclear
- ❌ **Wide Slice Logs:** **NOT GENERATED** (`fo_baseline_wide.jsonl`, `fo_rfl_wide.jsonl` do not exist)
- ⚠️ **Documentation:** Claims about Wide Slice Dyno Chart are **PLANNED / HYPOTHETICAL**, not real

---

## 1. What Actually Exists (File-by-File Audit)

### 1.1 Baseline Log Files

| File | Status | Lines | Cycles | Notes |
|------|--------|-------|--------|-------|
| `results/fo_baseline.jsonl` | ✅ **EXISTS** | ~1000 | 0-999 | Default slice (first-organism-slice), schema: old format (no `status`/`abstention` fields) |
| `results/fo_baseline_wide.jsonl` | ❌ **MISSING** | N/A | N/A | **PLANNED** - Requires `--slice-name=slice_medium --system=pl` |

**Schema Analysis (fo_baseline.jsonl):**
```json
{
  "cycle": 0,
  "mode": "baseline",
  "derivation": {
    "abstained": 1,
    "verified": 2,
    "candidates": 2
  },
  "rfl": {"executed": false}
  // NO "status", NO "abstention", NO "method" fields
}
```

**Abstention Inference:** Must use `derivation.abstained > 0` (✅ handled by normalization logic)

### 1.2 RFL Log Files

| File | Status | Lines | Cycles | Notes |
|------|--------|-------|--------|-------|
| `results/fo_rfl.jsonl` | ✅ **EXISTS** | Unknown | Unknown | Schema unknown, needs audit |
| `results/fo_rfl_50.jsonl` | ✅ **EXISTS** | ~11 | 0-10 | **CONFIRMED** - Small sanity run, has new schema with `status`/`abstention` |
| `results/fo_rfl_1000.jsonl` | ✅ **EXISTS** | Unknown | Unknown | Large run, schema unknown, needs audit |
| `results/fo_rfl_wide.jsonl` | ❌ **MISSING** | N/A | N/A | **PLANNED** - Requires Wide Slice run |

**Schema Analysis (fo_rfl_50.jsonl - NEW SCHEMA):**
```json
{
  "cycle": 0,
  "mode": "rfl",
  "status": "abstain",
  "method": "lean-disabled",
  "abstention": true,
  "derivation": {
    "abstained": 1,
    "verified": 2
  },
  "rfl": {
    "executed": true,
    "policy_update": true,
    "symbolic_descent": -0.75
  }
}
```

**Abstention Inference:** Direct `abstention: true` field (✅ handled by normalization logic)

### 1.3 Dyno Chart Figures

| File | Status | Size | Generated From | Notes |
|------|--------|------|----------------|-------|
| `artifacts/figures/rfl_dyno_chart.png` | ✅ **EXISTS** | Non-zero | **UNKNOWN** - Need to verify | May be from old script or placeholder |
| `artifacts/figures/rfl_dyno_chart.pdf` | ✅ **EXISTS** | Non-zero | **UNKNOWN** | Companion PDF |
| `artifacts/figures/rfl_abstention_rate.png` | ✅ **EXISTS** | Non-zero | `analyze_abstention_curves.py` | Generated by existing analysis script |

**Issue:** Cannot determine which log pair generated `rfl_dyno_chart.png` without metadata.

---

## 2. What the New Toolkit Does

### 2.1 `experiments/plotting.py` Enhancements

✅ **`setup_style()`:** High-DPI, monochrome-friendly matplotlib configuration  
✅ **`save_figure()`:** Saves PNG + PDF formats  
✅ **`plot_abstention_dynamics(df_baseline, df_rfl, window=100)`:**
   - Takes pandas DataFrames with `['cycle', 'is_abstention', 'run_type']`
   - Plots rolling mean abstention rate
   - Labels: "RFL Uplift: Abstention Rate vs Cycles (Wide Slice)"

✅ **`make_dyno_chart(baseline_path, rfl_path, window=100)`:**
   - Loads JSONL files
   - **Multi-strategy abstention normalization:**
     1. Direct `abstention` boolean field
     2. `status == "abstain"`
     3. `method == "lean-disabled"` (case-insensitive)
     4. `derivation.abstained > 0` (nested dict)
   - Adds `run_type` column
   - Generates plot

### 2.2 `experiments/generate_dyno_chart.py` CLI

✅ **Arguments:** `--baseline`, `--rfl`, `--window`, `--output-name`  
✅ **File validation:** Checks existence before processing  
✅ **Default paths:** `results/fo_baseline_wide.jsonl` / `results/fo_rfl_wide.jsonl` (⚠️ these don't exist yet)

---

## 3. The Gap: Wide Slice vs Reality

### 3.1 What Documentation Claims

From `experiments/FIGURES_CATALOG.md` line 76:
> **Data Source:** `results/fo_baseline_wide.jsonl` and `results/fo_rfl_wide.jsonl` (First Organism cycle logs from wide slice experiments) **[NOTE: Planned / Not yet generated — see `experiments/DYNO_CHART_QA_SUMMARY.md`]**

From `experiments/DYNO_CHART_QA_SUMMARY.md`:
> ❌ **Wide Slice Logs:** `results/fo_baseline_wide.jsonl` and `results/fo_rfl_wide.jsonl` not found

**Status:** Documentation correctly marks Wide Slice as **PLANNED / NOT YET GENERATED**.

### 3.2 What Actually Exists

**Real data available:**
- `results/fo_baseline.jsonl` (1000 cycles, default slice)
- `results/fo_rfl_50.jsonl` (11 cycles, RFL enabled)
- `results/fo_rfl_1000.jsonl` (unknown cycles, needs audit)

**Missing data:**
- Wide Slice logs (`slice_medium`) - **Phase II / NOT YET RUN**

### 3.3 What We CAN Generate Now

**Option 1: Use Existing Default Slice Logs**
```bash
uv run python experiments/generate_dyno_chart.py \
  --baseline results/fo_baseline.jsonl \
  --rfl results/fo_rfl_1000.jsonl \
  --window 100 \
  --output-name rfl_dyno_chart_default_slice
```

**Status:** ✅ **FEASIBLE** - But note: not Wide Slice, so label must say "Default Slice", not "Wide Slice"

**Option 2: Wait for Wide Slice Generation**
```bash
# First, generate Wide Slice logs (NOT YET RUN):
uv run python experiments/run_fo_cycles.py \
  --mode=baseline --cycles=1000 \
  --slice-name=slice_medium --system=pl \
  --out=results/fo_baseline_wide.jsonl

uv run python experiments/run_fo_cycles.py \
  --mode=rfl --cycles=1000 \
  --slice-name=slice_medium --system=pl \
  --out=results/fo_rfl_wide.jsonl

# Then generate Dyno Chart:
uv run python experiments/generate_dyno_chart.py --window 100
```

**Status:** ❌ **NOT YET RUN** - Phase II work

---

## 4. Sober Truth Assessment: Dyno Chart Evidence

### 4.1 What Can Be Claimed NOW (Phase I)

✅ **"We have a plotting toolkit that generates Dyno Charts from JSONL cycle logs"**
- Evidence: `experiments/plotting.py`, `experiments/generate_dyno_chart.py` exist and work
- Evidence: Multi-strategy normalization handles both old and new log schemas

✅ **"We have baseline and RFL cycle logs from the default First Organism slice"**
- Evidence: `results/fo_baseline.jsonl` (1000 cycles)
- Evidence: `results/fo_rfl_50.jsonl` (small sanity run)
- Evidence: `results/fo_rfl_1000.jsonl` (large run, needs audit)

⚠️ **"We can demonstrate abstention dynamics on the default slice"**
- Evidence: Logs exist with cycle data
- Limitation: RFL run is either 50 or 1000 cycles (need to verify which is complete)

❌ **"We have Wide Slice Dyno Chart results"**
- Reality: Wide Slice logs do NOT exist
- Status: **PLANNED / HYPOTHETICAL** - Move to Phase II / Future Work

### 4.2 What Should NOT Be Claimed

❌ **"Dyno Chart shows Wide Slice RFL uplift"** - Wide Slice not generated  
❌ **"1000-cycle RFL comparison"** - Need to verify `fo_rfl_1000.jsonl` is complete  
❌ **"slice_medium results"** - This slice was never run

### 4.3 Recommended Actions

1. **Immediate (Phase I):**
   - ✅ Verify `fo_rfl_1000.jsonl` cycle count and completeness
   - ✅ Generate Dyno Chart from existing default slice logs
   - ✅ Update chart title to say "Default Slice" not "Wide Slice"
   - ✅ Document which logs were actually used in chart metadata

2. **Phase II (Future Work):**
   - Generate Wide Slice logs (`slice_medium`)
   - Generate Wide Slice Dyno Chart
   - Update documentation to mark Wide Slice as "Phase II" not "Phase I"

---

## 5. Technical Issues Found

### 5.1 Schema Inconsistency

**Problem:** `fo_baseline.jsonl` uses old schema (no `status`/`abstention`), while `fo_rfl_50.jsonl` uses new schema.

**Resolution:** ✅ **HANDLED** - `make_dyno_chart()` normalization logic checks multiple fields:
- `abstention` boolean
- `status == "abstain"`
- `method == "lean-disabled"`
- `derivation.abstained > 0`

**Status:** ✅ **ROBUST** - Works with both schemas

### 5.2 Default Path Mismatch

**Problem:** `generate_dyno_chart.py` defaults to `fo_baseline_wide.jsonl` which doesn't exist.

**Impact:** CLI will fail with default arguments until Wide Slice logs are generated.

**Recommendation:** 
- Option A: Change defaults to existing files (`fo_baseline.jsonl`, `fo_rfl_1000.jsonl`)
- Option B: Keep defaults for Wide Slice, but add clear error message pointing to `--baseline` / `--rfl` flags

**Status:** ⚠️ **MINOR ISSUE** - Easy to work around with explicit flags

### 5.3 Missing Provenance Metadata

**Problem:** Existing `rfl_dyno_chart.png` has no metadata about which logs generated it.

**Recommendation:** 
- Add text annotation to chart: "Generated from: baseline=X, rfl=Y, window=Z, date=..."
- Or: Generate manifest JSON alongside PNG/PDF with provenance

**Status:** ⚠️ **DOCUMENTATION GAP** - Chart exists but we can't verify its source

---

## 6. Documentation Updates Needed

### 6.1 `experiments/FIGURES_CATALOG.md`

**Current:** Says Wide Slice logs are "Planned / Not yet generated" ✅ **CORRECT**

**Action:** No change needed - already honest about status

### 6.2 `experiments/DYNO_CHART_QA_SUMMARY.md`

**Current:** Correctly states Wide Slice logs are missing ✅

**Action:** Add section documenting what CAN be generated now (default slice)

### 6.3 Chart Titles and Labels

**Issue:** Chart title says "Wide Slice" but Wide Slice data doesn't exist.

**Action:** 
- If generating from default slice: Change title to "Default Slice" or "First Organism Slice"
- If generating from Wide Slice: Keep "Wide Slice" title (but only after Wide Slice logs exist)

**Code Location:** `experiments/plotting.py` line 360:
```python
ax.set_title('RFL Uplift: Abstention Rate vs Cycles (Wide Slice)', ...)
```

**Recommendation:** Make title configurable via parameter, or auto-detect from slice_name in logs

---

## 7. Validation Checklist

### 7.1 Can Generate Dyno Chart Now?

- [x] Plotting toolkit exists and works
- [x] Baseline log exists (`fo_baseline.jsonl`)
- [ ] RFL log verified complete (`fo_rfl_1000.jsonl` needs audit)
- [ ] Chart generated from verified logs
- [ ] Chart labels reflect actual data source (not "Wide Slice" if using default)

### 7.2 Can Claim Wide Slice Dyno Chart?

- [ ] Wide Slice baseline log generated (`fo_baseline_wide.jsonl`)
- [ ] Wide Slice RFL log generated (`fo_rfl_wide.jsonl`)
- [ ] Chart generated from Wide Slice logs
- [ ] Documentation updated to mark as "Phase II Complete"

**Status:** ❌ **NOT YET** - All items unchecked, Wide Slice is Phase II

---

## 8. Recommended Next Steps (Cursor H Scope)

1. **Audit Existing RFL Logs**
   - Verify `fo_rfl_1000.jsonl` cycle count and completeness
   - Check `fo_rfl.jsonl` schema and contents
   - Document findings in this report

2. **Generate Dyno Chart from Existing Data**
   - Use `fo_baseline.jsonl` + `fo_rfl_1000.jsonl` (if complete)
   - Update title to reflect actual slice used
   - Save as `rfl_dyno_chart_default_slice.png` (or update existing)

3. **Update Chart Title Logic**
   - Make title configurable (remove hardcoded "Wide Slice")
   - Auto-detect slice name from log metadata if available

4. **Add Provenance Tracking**
   - Generate manifest JSON with chart: `rfl_dyno_chart_manifest.json`
   - Include: source files, cycle counts, window size, generation timestamp

5. **Documentation Updates**
   - Update `FIGURES_CATALOG.md` to distinguish "Default Slice" vs "Wide Slice" charts
   - Mark Wide Slice as "Phase II / Planned"

---

## 9. Conclusion

**What Works:**
- ✅ Plotting toolkit is complete and functional
- ✅ Handles schema variations robustly
- ✅ Real log data exists for default slice

**What's Missing:**
- ❌ Wide Slice logs (planned, not generated)
- ⚠️ Provenance metadata for existing charts
- ⚠️ Verification of `fo_rfl_1000.jsonl` completeness

**What Can Be Claimed:**
- ✅ "Plotting toolkit generates Dyno Charts" (code exists)
- ✅ "Default slice logs demonstrate abstention dynamics" (data exists, needs chart generation)
- ❌ "Wide Slice Dyno Chart results" (move to Phase II)

**Reviewer 2 Verdict:** Documentation is mostly honest about Wide Slice being planned. Toolkit is ready. Need to generate chart from existing default slice data and clearly label it as such, not as "Wide Slice."

---

## 10. Phase I Default-Slice Dyno Chart (Baseline vs fo_rfl.jsonl)

**Status:** ✅ **GENERATED WITH PROVENANCE MANIFEST**

### 10.1 Chart Generation

**Command Executed:**
```bash
python experiments/generate_dyno_chart.py \
  --baseline results/fo_baseline.jsonl \
  --rfl results/fo_rfl.jsonl \
  --window 100 \
  --output-name rfl_dyno_chart
```

**Output Files:**
- `artifacts/figures/rfl_dyno_chart.png` - Chart visualization
- `artifacts/figures/rfl_dyno_chart.pdf` - PDF version
- `artifacts/figures/rfl_dyno_chart_manifest.json` - Provenance manifest

### 10.2 Data Source Analysis

**Baseline Log (`results/fo_baseline.jsonl`):**
- **Cycles:** 1000 (0-999)
- **Schema:** Old format (no `status`/`abstention` fields)
- **Abstention Detection:** Via `derivation.abstained > 0`
- **Abstention Rate:** **100%** (all cycles show `derivation.abstained: 1`)

**RFL Log (`results/fo_rfl.jsonl`):**
- **Cycles:** 1000 (0-999)
- **Schema:** New format (has `status`, `abstention`, `method` fields)
- **Abstention Detection:** Via direct `abstention: true` field
- **Abstention Rate:** **100%** (all cycles show `abstention: true`, `status: "abstain"`)

**Slice Information:**
- **Slice Name:** `first-organism-pl` (Default Slice)
- **Display Name:** "Default Slice" (auto-detected in chart title)

### 10.3 Chart Characteristics

**Visual Result:**
- **Baseline Series:** Flat line at y=1.0 (100% abstention rate)
- **RFL Series:** Flat line at y=1.0 (100% abstention rate)
- **Both lines are overlapping** - No visible difference

**Chart Title:** "RFL Uplift: Abstention Rate vs Cycles (Default Slice)"
- ✅ Correctly shows "Default Slice" (not "Wide Slice")
- ✅ Title is slice-aware via auto-detection

**Rolling Window:** 100 cycles
- Rolling mean calculation works correctly
- With 100% abstention rate, rolling mean remains flat at 1.0

### 10.4 Critical Finding: No Uplift Demonstrated

**Explicit Statement:**

> **This chart validates the plotting and normalization pipeline but does not demonstrate RFL uplift.**

**Key Observations:**

1. **Abstention Rates:** Both baseline and RFL show 100% abstention across all 1000 cycles
   - Baseline: 1000/1000 cycles abstained (100%)
   - RFL: 1000/1000 cycles abstained (100%)
   - **Delta (RFL - Baseline):** 0% (no change)

2. **Flat Lines:** Both series are perfectly flat at y=1.0
   - No convergence visible
   - No reduction in abstention rate over time
   - No differential behavior between baseline and RFL

3. **Normalization Pipeline Validation:**
   - ✅ Successfully handled old schema (baseline) via `derivation.abstained > 0`
   - ✅ Successfully handled new schema (RFL) via `abstention: true`
   - ✅ Both schemas correctly normalized to `is_abstention` boolean column
   - ✅ Rolling mean calculation works correctly (just happens to be constant)

4. **What This Means:**
   - **Positive:** The plotting toolkit works end-to-end with mixed schemas
   - **Positive:** Normalization logic correctly extracts abstention from both formats
   - **Positive:** Chart generation pipeline is validated and functional
   - **Negative:** This particular run shows no RFL effect on abstention behavior
   - **Neutral:** May indicate test conditions (all candidates failing verification) rather than RFL inefficacy

### 10.5 Provenance Manifest

**File:** `artifacts/figures/rfl_dyno_chart_manifest.json`

**Contents:**
```json
{
  "chart_name": "rfl_dyno_chart",
  "generated_at": "2025-01-02T00:00:00",
  "baseline_path": "results/fo_baseline.jsonl",
  "rfl_path": "results/fo_rfl.jsonl",
  "baseline_cycles": 1000,
  "rfl_cycles": 1000,
  "baseline_cycle_range": [0, 999],
  "rfl_cycle_range": [0, 999],
  "window_size": 100,
  "slice_name": "first-organism-pl",
  "slice_display": "Default Slice",
  "abstention_summary": {
    "baseline_total_abstentions": 1000,
    "baseline_abstention_rate": 1.0,
    "rfl_total_abstentions": 1000,
    "rfl_abstention_rate": 1.0,
    "uplift_demonstrated": false,
    "note": "Both series show flat abstention (100%). This validates the plotting pipeline but does not demonstrate RFL uplift."
  }
}
```

**Key Metadata:**
- ✅ Source files documented
- ✅ Cycle counts verified
- ✅ Abstention rates calculated
- ✅ Explicit note about no uplift demonstrated
- ✅ Slice information included

### 10.6 What This Chart Shows (and Doesn't Show)

**What It Shows:**
- ✅ Baseline abstention behavior (100% constant)
- ✅ RFL abstention behavior under same conditions (100% constant)
- ✅ Pipeline normalization works with mixed schemas
- ✅ Rolling window calculation functions correctly

**What It Doesn't Show:**
- ❌ RFL reducing abstention rate
- ❌ Convergence or learning behavior
- ❌ Differential dynamics between baseline and RFL
- ❌ Any measurable uplift

**Why This Is Still Valuable:**
1. **Pipeline Validation:** Confirms the entire data loading → normalization → plotting pipeline works
2. **Schema Compatibility:** Demonstrates robust handling of old vs new log formats
3. **Baseline Behavior:** Documents actual abstention rates in default slice test conditions
4. **Reproducibility:** Provenance manifest enables full reproducibility

**For Phase I Evidence Pack:**
- ✅ Can claim: "We have a validated plotting pipeline for Dyno Charts"
- ✅ Can claim: "We generated a Dyno Chart from Phase I default slice logs"
- ❌ **Cannot claim:** "This chart demonstrates RFL uplift" (it doesn't)
- ⚠️ **Must note:** "This chart validates the pipeline but shows no RFL effect on abstention under these test conditions"

---

**End of Report**

